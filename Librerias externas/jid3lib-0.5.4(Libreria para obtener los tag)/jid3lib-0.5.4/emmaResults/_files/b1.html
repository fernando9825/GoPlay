<HTML><HEAD><META CONTENT="text/html; charset=ISO-8859-1" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" WIDTH="100%" CELLSPACING="0"><TR><TH CLASS="tl"><A HREF="http://emma.sourceforge.net/">EMMA</A> Coverage Report (generated Tue Mar 14 21:50:42 EST 2006)</TH></TR><TR><TD CLASS="nv">[<A HREF="../coverage.html">all classes</A>][<A HREF="4.html">org.farng.mp3</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">MP3File.java</SPAN>]</H2><TABLE WIDTH="100%" CELLSPACING="0"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>MP3File.java</TD><TD>100% (1/1)</TD><TD CLASS="h">49%  (28/57)</TD><TD CLASS="h">74%  (1211/1636)</TD><TD CLASS="h">74%  (296.1/402)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" WIDTH="100%" CELLSPACING="0"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">MP3File</A></TD><TD>100% (1/1)</TD><TD CLASS="h">49%  (28/57)</TD><TD CLASS="h">74%  (1211/1636)</TD><TD CLASS="h">74%  (296.1/402)</TD></TR><TR><TD CLASS="f"><A HREF="#1">MP3File (MP3File): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/88)</TD><TD CLASS="h">0%   (0/20)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">MP3File (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#3">delete (AbstractMP3Tag): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">getBitRate (): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#5">getEmphasis (): byte</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">getFrequency (): double</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#7">getLayer (): byte</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">getMode (): byte</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#9">getModeExtension (): byte</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">getMpegVersion (): byte</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#b">hasFilenameTag (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">hasID3v1Tag (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#d">hasLyrics3Tag (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">isCopyProtected (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#f">isHome (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">isPadding (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#11">isPrivacy (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">isProtection (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#13">isUnsynchronized (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">isVariableBitRate (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#15">save (File): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">save (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#17">save (String, int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">save (int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#19">seekMP3Frame (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">setID3v1Tag (AbstractMP3Tag): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">setID3v2Tag (AbstractMP3Tag): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">setLyrics3Tag (AbstractMP3Tag): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">setVariableBitRate (boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">getFrameSize (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">63%  (31/49)</TD><TD CLASS="h">71%  (5/7)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">getMp3StartByte (File): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">77%  (24/31)</TD><TD>91%  (7.3/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">save (File, int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">79%  (148/188)</TD><TD>83%  (39/47)</TD></TR><TR><TD CLASS="f"><A HREF="#21">MP3File (File, boolean): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">80%  (78/98)</TD><TD>88%  (30/34)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">readFrameHeader (RandomAccessFile): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>82%  (199/244)</TD><TD CLASS="h">66%  (31.9/48)</TD></TR><TR><TD CLASS="f"><A HREF="#23">seekMP3Frame (RandomAccessFile): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>88%  (52/59)</TD><TD CLASS="h">78%  (15.6/20)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">adjustID3v2Padding (int, boolean, boolean, File): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>91%  (256/280)</TD><TD>94%  (57.4/61)</TD></TR><TR><TD CLASS="f"><A HREF="#25">seekNextMP3Frame (RandomAccessFile, int): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>93%  (65/70)</TD><TD>90%  (19/21)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">getUnsynchronizedFragments (): Set</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>97%  (118/122)</TD><TD>96%  (27/28)</TD></TR><TR><TD CLASS="f"><A HREF="#0">MP3File (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">MP3File (File): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (5/5)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#29">adjustID3v2Padding (): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (11/11)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">adjustID3v2Padding (int, boolean, boolean): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (8/8)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">getFilenameTag (): FilenameTag</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">getFrameAcrossTags (String): List</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (110/110)</TD><TD>100% (26/26)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">getID3v1Tag (): ID3v1</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">getID3v2Tag (): AbstractID3v2</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">getLyrics3Tag (): AbstractLyrics3</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#30">getMp3StartByte (): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (5/5)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#31">getMp3file (): File</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">hasID3v2Tag (): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (7/7)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#33">save (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (7/7)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#34">setFilenameTag (FilenameTag): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#35">setFrameAcrossTags (AbstractID3v2Frame): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (49/49)</TD><TD>100% (13/13)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#36">setID3v1Tag (ID3v1): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#37">setID3v2Tag (AbstractID3v2): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#38">setLyrics3Tag (AbstractLyrics3): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#39">setMp3file (File): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (2/2)</TD></TR></TABLE><P></P><TABLE CLASS="s" WIDTH="100%" CELLSPACING="0"><TR><TD CLASS="l">1</TD><TD>package org.farng.mp3;</TD></TR><TR><TD CLASS="l">2</TD><TD> </TD></TR><TR><TD CLASS="l">3</TD><TD>import org.farng.mp3.filename.FilenameTag;</TD></TR><TR><TD CLASS="l">4</TD><TD>import org.farng.mp3.filename.FilenameTagBuilder;</TD></TR><TR><TD CLASS="l">5</TD><TD>import org.farng.mp3.id3.AbstractID3v2;</TD></TR><TR><TD CLASS="l">6</TD><TD>import org.farng.mp3.id3.AbstractID3v2Frame;</TD></TR><TR><TD CLASS="l">7</TD><TD>import org.farng.mp3.id3.ID3v1;</TD></TR><TR><TD CLASS="l">8</TD><TD>import org.farng.mp3.id3.ID3v1_1;</TD></TR><TR><TD CLASS="l">9</TD><TD>import org.farng.mp3.id3.ID3v2_2;</TD></TR><TR><TD CLASS="l">10</TD><TD>import org.farng.mp3.id3.ID3v2_3;</TD></TR><TR><TD CLASS="l">11</TD><TD>import org.farng.mp3.id3.ID3v2_4;</TD></TR><TR><TD CLASS="l">12</TD><TD>import org.farng.mp3.lyrics3.AbstractLyrics3;</TD></TR><TR><TD CLASS="l">13</TD><TD>import org.farng.mp3.lyrics3.Lyrics3v1;</TD></TR><TR><TD CLASS="l">14</TD><TD>import org.farng.mp3.lyrics3.Lyrics3v2;</TD></TR><TR><TD CLASS="l">15</TD><TD> </TD></TR><TR><TD CLASS="l">16</TD><TD>import java.io.EOFException;</TD></TR><TR><TD CLASS="l">17</TD><TD>import java.io.File;</TD></TR><TR><TD CLASS="l">18</TD><TD>import java.io.FileInputStream;</TD></TR><TR><TD CLASS="l">19</TD><TD>import java.io.FileNotFoundException;</TD></TR><TR><TD CLASS="l">20</TD><TD>import java.io.FileOutputStream;</TD></TR><TR><TD CLASS="l">21</TD><TD>import java.io.IOException;</TD></TR><TR><TD CLASS="l">22</TD><TD>import java.io.RandomAccessFile;</TD></TR><TR><TD CLASS="l">23</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">24</TD><TD>import java.util.HashSet;</TD></TR><TR><TD CLASS="l">25</TD><TD>import java.util.Iterator;</TD></TR><TR><TD CLASS="l">26</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">27</TD><TD>import java.util.Set;</TD></TR><TR><TD CLASS="l">28</TD><TD> </TD></TR><TR><TD CLASS="l">29</TD><TD>/**</TD></TR><TR><TD CLASS="l">30</TD><TD> * &lt;TABLE border=0&gt; &lt;TBODY&gt; &lt;TR&gt; &lt;TD class=h2&gt;How is MP3 built?&lt;/TD&gt;&lt;/TR&gt;&lt;/TBODY&gt;&lt;/TABLE&gt; &lt;TABLE border=0&gt; &lt;TBODY&gt; &lt;TR</TD></TR><TR><TD CLASS="l">31</TD><TD> * vAlign=top&gt; &lt;TD&gt; &lt;P&gt;Most people with a little knowledge in MP3 files know that the sound is divided into smaller</TD></TR><TR><TD CLASS="l">32</TD><TD> * parts and compressed with a psycoacoustic model. This smaller pieces of the audio is then put into something called</TD></TR><TR><TD CLASS="l">33</TD><TD> * 'frames', which is a little datablock with a header. I'll focus on that header in this text.&lt;/P&gt;</TD></TR><TR><TD CLASS="l">34</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">35</TD><TD> * &lt;P&gt;The header is 4 bytes, 32 bits, big and begins with something called sync. This sync is, at least according to the</TD></TR><TR><TD CLASS="l">36</TD><TD> * MPEG standard, 12 set bits in a row. Some add-on standards made later uses 11 set bits and one cleared bit. The sync</TD></TR><TR><TD CLASS="l">37</TD><TD> * is directly followed by a ID bit, indicating if the file is a MPEG-1 och MPEG-2 file. 0=MPEG-2 and 1=MPEG-1&lt;/P&gt;</TD></TR><TR><TD CLASS="l">38</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">39</TD><TD> * &lt;P&gt;The layer is defined with the two layers bits. They are oddly defined as&lt;/P&gt; &lt;CENTER&gt; &lt;TABLE cellSpacing=0</TD></TR><TR><TD CLASS="l">40</TD><TD> * cellPadding=2 border=1&gt; &lt;TBODY&gt; &lt;TR&gt; &lt;TD&gt;0 0&lt;/TD&gt; &lt;TD&gt;Not defined&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 1&lt;/TD&gt; &lt;TD&gt;Layer III&lt;/TD&gt;&lt;/TR&gt;</TD></TR><TR><TD CLASS="l">41</TD><TD> * &lt;TR&gt; &lt;TD&gt;1 0&lt;/TD&gt; &lt;TD&gt;Layer II&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 1&lt;/TD&gt; &lt;TD&gt;Layer I&lt;/TD&gt;&lt;/TR&gt;&lt;/TBODY&gt;&lt;/TABLE&gt; &lt;/CENTER&gt;</TD></TR><TR><TD CLASS="l">42</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">43</TD><TD> * &lt;P&gt;With this information and the information in the bitrate field we can determine the bitrate of the audio (in</TD></TR><TR><TD CLASS="l">44</TD><TD> * kbit/s) according to this table.&lt;/P&gt; &lt;CENTER&gt; &lt;TABLE cellSpacing=0 cellPadding=2 border=1&gt; &lt;TBODY&gt; &lt;TR&gt;</TD></TR><TR><TD CLASS="l">45</TD><TD> * &lt;TD&gt;Bitrate&lt;BR&gt;value&lt;/TD&gt; &lt;TD&gt;MPEG-1,&lt;BR&gt;layer I&lt;/TD&gt; &lt;TD&gt;MPEG-1,&lt;BR&gt;layer II&lt;/TD&gt; &lt;TD&gt;MPEG-1,&lt;BR&gt;layer III&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">46</TD><TD> * &lt;TD&gt;MPEG-2,&lt;BR&gt;layer I&lt;/TD&gt; &lt;TD&gt;MPEG-2,&lt;BR&gt;layer II&lt;/TD&gt; &lt;TD&gt;MPEG-2,&lt;BR&gt;layer III&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 0 0 0&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">47</TD><TD> * &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 0 0 1&lt;/TD&gt; &lt;TD&gt;32&lt;/TD&gt; &lt;TD&gt;32&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">48</TD><TD> * &lt;TD&gt;32&lt;/TD&gt; &lt;TD&gt;32&lt;/TD&gt; &lt;TD&gt;32&lt;/TD&gt; &lt;TD&gt;8&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 0 1 0&lt;/TD&gt; &lt;TD&gt;64&lt;/TD&gt; &lt;TD&gt;48&lt;/TD&gt; &lt;TD&gt;40&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">49</TD><TD> * &lt;TD&gt;64&lt;/TD&gt; &lt;TD&gt;48&lt;/TD&gt; &lt;TD&gt;16&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 0 1 1&lt;/TD&gt; &lt;TD&gt;96&lt;/TD&gt; &lt;TD&gt;56&lt;/TD&gt; &lt;TD&gt;48&lt;/TD&gt; &lt;TD&gt;96&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">50</TD><TD> * &lt;TD&gt;56&lt;/TD&gt; &lt;TD&gt;24&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 1 0 0&lt;/TD&gt; &lt;TD&gt;128&lt;/TD&gt; &lt;TD&gt;64&lt;/TD&gt; &lt;TD&gt;56&lt;/TD&gt; &lt;TD&gt;128&lt;/TD&gt; &lt;TD&gt;64&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">51</TD><TD> * &lt;TD&gt;32&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 1 0 1&lt;/TD&gt; &lt;TD&gt;160&lt;/TD&gt; &lt;TD&gt;80&lt;/TD&gt; &lt;TD&gt;64&lt;/TD&gt; &lt;TD&gt;160&lt;/TD&gt; &lt;TD&gt;80&lt;/TD&gt; &lt;TD&gt;64&lt;/TD&gt;&lt;/TR&gt;</TD></TR><TR><TD CLASS="l">52</TD><TD> * &lt;TR&gt; &lt;TD&gt;0 1 1 0&lt;/TD&gt; &lt;TD&gt;192&lt;/TD&gt; &lt;TD&gt;96&lt;/TD&gt; &lt;TD&gt;80&lt;/TD&gt; &lt;TD&gt;192&lt;/TD&gt; &lt;TD&gt;96&lt;/TD&gt; &lt;TD&gt;80&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 1 1</TD></TR><TR><TD CLASS="l">53</TD><TD> * 1&lt;/TD&gt; &lt;TD&gt;224&lt;/TD&gt; &lt;TD&gt;112&lt;/TD&gt; &lt;TD&gt;96&lt;/TD&gt; &lt;TD&gt;224&lt;/TD&gt; &lt;TD&gt;112&lt;/TD&gt; &lt;TD&gt;56&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 0 0 0&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">54</TD><TD> * &lt;TD&gt;256&lt;/TD&gt; &lt;TD&gt;128&lt;/TD&gt; &lt;TD&gt;112&lt;/TD&gt; &lt;TD&gt;256&lt;/TD&gt; &lt;TD&gt;128&lt;/TD&gt; &lt;TD&gt;64&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 0 0 1&lt;/TD&gt; &lt;TD&gt;288&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">55</TD><TD> * &lt;TD&gt;160&lt;/TD&gt; &lt;TD&gt;128&lt;/TD&gt; &lt;TD&gt;288&lt;/TD&gt; &lt;TD&gt;160&lt;/TD&gt; &lt;TD&gt;128&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 0 1 0&lt;/TD&gt; &lt;TD&gt;320&lt;/TD&gt; &lt;TD&gt;192&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">56</TD><TD> * &lt;TD&gt;160&lt;/TD&gt; &lt;TD&gt;320&lt;/TD&gt; &lt;TD&gt;192&lt;/TD&gt; &lt;TD&gt;160&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 0 1 1&lt;/TD&gt; &lt;TD&gt;352&lt;/TD&gt; &lt;TD&gt;224&lt;/TD&gt; &lt;TD&gt;192&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">57</TD><TD> * &lt;TD&gt;352&lt;/TD&gt; &lt;TD&gt;224&lt;/TD&gt; &lt;TD&gt;112&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 1 0 0&lt;/TD&gt; &lt;TD&gt;384&lt;/TD&gt; &lt;TD&gt;256&lt;/TD&gt; &lt;TD&gt;224&lt;/TD&gt; &lt;TD&gt;384&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">58</TD><TD> * &lt;TD&gt;256&lt;/TD&gt; &lt;TD&gt;128&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 1 0 1&lt;/TD&gt; &lt;TD&gt;416&lt;/TD&gt; &lt;TD&gt;320&lt;/TD&gt; &lt;TD&gt;256&lt;/TD&gt; &lt;TD&gt;416&lt;/TD&gt; &lt;TD&gt;320&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">59</TD><TD> * &lt;TD&gt;256&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 1 1 0&lt;/TD&gt; &lt;TD&gt;448&lt;/TD&gt; &lt;TD&gt;384&lt;/TD&gt; &lt;TD&gt;320&lt;/TD&gt; &lt;TD&gt;448&lt;/TD&gt; &lt;TD&gt;384&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">60</TD><TD> * &lt;TD&gt;320&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 1 1 1&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">61</TD><TD> * &lt;TD&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TBODY&gt;&lt;/TABLE&gt; &lt;/CENTER&gt;</TD></TR><TR><TD CLASS="l">62</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">63</TD><TD> * &lt;P&gt;The sample rate is described in the frequency field. These values is dependent of which MPEG standard is used</TD></TR><TR><TD CLASS="l">64</TD><TD> * according to the following table.&lt;/P&gt; &lt;CENTER&gt; &lt;TABLE cellSpacing=0 cellPadding=2 border=1&gt; &lt;TBODY&gt; &lt;TR&gt;</TD></TR><TR><TD CLASS="l">65</TD><TD> * &lt;TD&gt;Frequency&lt;BR&gt;value&lt;/TD&gt; &lt;TD&gt;MPEG-1&lt;/TD&gt; &lt;TD&gt;MPEG-2&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 0&lt;/TD&gt; &lt;TD&gt;44100 Hz&lt;/TD&gt; &lt;TD&gt;22050</TD></TR><TR><TD CLASS="l">66</TD><TD> * Hz&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 1&lt;/TD&gt; &lt;TD&gt;48000 Hz&lt;/TD&gt; &lt;TD&gt;24000 Hz&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 0&lt;/TD&gt; &lt;TD&gt;32000 Hz&lt;/TD&gt; &lt;TD&gt;16000</TD></TR><TR><TD CLASS="l">67</TD><TD> * Hz&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 1&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt; &lt;TD&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TBODY&gt;&lt;/TABLE&gt; &lt;/CENTER&gt;</TD></TR><TR><TD CLASS="l">68</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">69</TD><TD> * &lt;P&gt;Three bits is not needed in the decoding process at all. These are the copyright bit, original home bit and the</TD></TR><TR><TD CLASS="l">70</TD><TD> * private bit. The copyright has the same meaning as the copyright bit on CDs and DAT tapes, i.e. telling that it is</TD></TR><TR><TD CLASS="l">71</TD><TD> * illegal to copy the contents if the bit is set. The original home bit indicates, if set, that the frame is located on</TD></TR><TR><TD CLASS="l">72</TD><TD> * its original media. No one seems to know what the privat bit is good for.</TD></TR><TR><TD CLASS="l">73</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">74</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">75</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">76</TD><TD> * &lt;P&gt;If the protection bit is NOT set then the frame header is followed by a 16 bit checksum, inserted before the audio</TD></TR><TR><TD CLASS="l">77</TD><TD> * data. If the padding bit is set then the frame is padded with an extra byte. Knowing this the size of the complete</TD></TR><TR><TD CLASS="l">78</TD><TD> * frame can be calculated with the following formula&lt;/P&gt; &lt;CENTER&gt; &lt;P&gt;FrameSize = 144 * BitRate / SampleRate&lt;BR&gt;when the</TD></TR><TR><TD CLASS="l">79</TD><TD> * padding bit is cleared and&lt;/P&gt;</TD></TR><TR><TD CLASS="l">80</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">81</TD><TD> * &lt;P&gt;FrameSize = (144 * BitRate / SampleRate) + 1&lt;BR&gt;when the padding bit is set.</TD></TR><TR><TD CLASS="l">82</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">83</TD><TD> * &lt;P&gt;&lt;/CENTER&gt;</TD></TR><TR><TD CLASS="l">84</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">85</TD><TD> * &lt;P&gt;The frameSize is of course an integer. If for an example BitRate=128000, SampleRate=44100 and the padding bit is</TD></TR><TR><TD CLASS="l">86</TD><TD> * cleared, then the FrameSize = 144 * 128000 / 44100 = 417</TD></TR><TR><TD CLASS="l">87</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">88</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">89</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">90</TD><TD> * &lt;P&gt;The mode field is used to tell which sort of stereo/mono encoding that has been used. The purpose of the mode</TD></TR><TR><TD CLASS="l">91</TD><TD> * extension field is different for different layers, but I really don't know exactly what it's for.&lt;/P&gt; &lt;CENTER&gt; &lt;TABLE</TD></TR><TR><TD CLASS="l">92</TD><TD> * cellSpacing=0 cellPadding=2 border=1&gt; &lt;TBODY&gt; &lt;TR&gt; &lt;TD&gt;Mode value&lt;/TD&gt; &lt;TD&gt;mode&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 0&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">93</TD><TD> * &lt;TD&gt;Stereo&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 1&lt;/TD&gt; &lt;TD&gt;Joint stereo&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 0&lt;/TD&gt; &lt;TD&gt;Dual channel&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt;</TD></TR><TR><TD CLASS="l">94</TD><TD> * &lt;TD&gt;1 1&lt;/TD&gt; &lt;TD&gt;Mono&lt;/TD&gt;&lt;/TR&gt;&lt;/TBODY&gt;&lt;/TABLE&gt; &lt;/CENTER&gt;</TD></TR><TR><TD CLASS="l">95</TD><TD> * &lt;p/&gt;</TD></TR><TR><TD CLASS="l">96</TD><TD> * &lt;P&gt;The last field is the emphasis field. It is used to sort of 're-equalize' the sound after a Dolby-like noise</TD></TR><TR><TD CLASS="l">97</TD><TD> * supression. This is not very used and will probably never be. The following noise supression model is used&lt;/P&gt;</TD></TR><TR><TD CLASS="l">98</TD><TD> * &lt;CENTER&gt; &lt;TABLE cellSpacing=0 cellPadding=2 border=1&gt; &lt;TBODY&gt; &lt;TR&gt; &lt;TD&gt;Emphasis value&lt;/TD&gt; &lt;TD&gt;Emphasis</TD></TR><TR><TD CLASS="l">99</TD><TD> * method&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 0&lt;/TD&gt; &lt;TD&gt;none&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;0 1&lt;/TD&gt; &lt;TD&gt;50/15ms&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 0&lt;/TD&gt;</TD></TR><TR><TD CLASS="l">100</TD><TD> * &lt;TD&gt;&lt;/TD&gt;&lt;/TR&gt; &lt;TR&gt; &lt;TD&gt;1 1&lt;/TD&gt; &lt;TD&gt;CCITT j.17&lt;/TD&gt;&lt;/TR&gt;&lt;/TBODY&gt;&lt;/TABLE&gt; &lt;/CENTER&gt;&lt;/TD&gt; &lt;/TR&gt;&lt;/TBODY&gt;&lt;/TABLE&gt;</TD></TR><TR><TD CLASS="l">101</TD><TD> *</TD></TR><TR><TD CLASS="l">102</TD><TD> * @author Eric Farng</TD></TR><TR><TD CLASS="l">103</TD><TD> * @version $Revision: 1.5 $</TD></TR><TR><TD CLASS="l">104</TD><TD> */</TD></TR><TR><TD CLASS="l">105</TD><TD>public class MP3File {</TD></TR><TR><TD CLASS="l">106</TD><TD> </TD></TR><TR><TD CLASS="l">107</TD><TD>    /**</TD></TR><TR><TD CLASS="l">108</TD><TD>     * the ID3v2 tag that this file contains.</TD></TR><TR><TD CLASS="l">109</TD><TD>     */</TD></TR><TR><TD CLASS="l">110</TD><TD>    private AbstractID3v2 id3v2tag;</TD></TR><TR><TD CLASS="l">111</TD><TD>    /**</TD></TR><TR><TD CLASS="l">112</TD><TD>     * the Lyrics3 tag that this file contains.</TD></TR><TR><TD CLASS="l">113</TD><TD>     */</TD></TR><TR><TD CLASS="l">114</TD><TD>    private AbstractLyrics3 lyrics3tag;</TD></TR><TR><TD CLASS="l">115</TD><TD>    /**</TD></TR><TR><TD CLASS="l">116</TD><TD>     * the mp3 file that this instance represents. This value can be null. This value is also used for any methods that</TD></TR><TR><TD CLASS="l">117</TD><TD>     * are called without a file argument</TD></TR><TR><TD CLASS="l">118</TD><TD>     */</TD></TR><TR><TD CLASS="l">119</TD><TD>    private File mp3file;</TD></TR><TR><TD CLASS="l">120</TD><TD>    /**</TD></TR><TR><TD CLASS="l">121</TD><TD>     * the ID3v2_4 tag that represents the parsed filename.</TD></TR><TR><TD CLASS="l">122</TD><TD>     */</TD></TR><TR><TD CLASS="l">123</TD><TD>    private FilenameTag filenameTag;</TD></TR><TR><TD CLASS="l">124</TD><TD>    /**</TD></TR><TR><TD CLASS="l">125</TD><TD>     * the ID3v1 tag that this file contains.</TD></TR><TR><TD CLASS="l">126</TD><TD>     */</TD></TR><TR><TD CLASS="l">127</TD><TD>    private ID3v1 id3v1tag;</TD></TR><TR><TD CLASS="l">128</TD><TD>    /**</TD></TR><TR><TD CLASS="l">129</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">130</TD><TD>     */</TD></TR><TR><TD CLASS="l">131</TD><TD>    private boolean copyProtected;</TD></TR><TR><TD CLASS="l">132</TD><TD>    /**</TD></TR><TR><TD CLASS="l">133</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">134</TD><TD>     */</TD></TR><TR><TD CLASS="l">135</TD><TD>    private boolean home;</TD></TR><TR><TD CLASS="l">136</TD><TD>    /**</TD></TR><TR><TD CLASS="l">137</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">138</TD><TD>     */</TD></TR><TR><TD CLASS="l">139</TD><TD>    private boolean padding;</TD></TR><TR><TD CLASS="l">140</TD><TD>    /**</TD></TR><TR><TD CLASS="l">141</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">142</TD><TD>     */</TD></TR><TR><TD CLASS="l">143</TD><TD>    private boolean privacy;</TD></TR><TR><TD CLASS="l">144</TD><TD>    /**</TD></TR><TR><TD CLASS="l">145</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">146</TD><TD>     */</TD></TR><TR><TD CLASS="l">147</TD><TD>    private boolean protection;</TD></TR><TR><TD CLASS="l">148</TD><TD>    /**</TD></TR><TR><TD CLASS="l">149</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">150</TD><TD>     */</TD></TR><TR><TD CLASS="l">151</TD><TD>    private boolean variableBitRate;</TD></TR><TR><TD CLASS="l">152</TD><TD>    /**</TD></TR><TR><TD CLASS="l">153</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">154</TD><TD>     */</TD></TR><TR><TD CLASS="l">155</TD><TD>    private byte emphasis;</TD></TR><TR><TD CLASS="l">156</TD><TD>    /**</TD></TR><TR><TD CLASS="l">157</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">158</TD><TD>     */</TD></TR><TR><TD CLASS="l">159</TD><TD>    private byte layer;</TD></TR><TR><TD CLASS="l">160</TD><TD>    /**</TD></TR><TR><TD CLASS="l">161</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">162</TD><TD>     */</TD></TR><TR><TD CLASS="l">163</TD><TD>    private byte mode;</TD></TR><TR><TD CLASS="l">164</TD><TD>    /**</TD></TR><TR><TD CLASS="l">165</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">166</TD><TD>     */</TD></TR><TR><TD CLASS="l">167</TD><TD>    private byte modeExtension;</TD></TR><TR><TD CLASS="l">168</TD><TD>    /**</TD></TR><TR><TD CLASS="l">169</TD><TD>     * value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">170</TD><TD>     */</TD></TR><TR><TD CLASS="l">171</TD><TD>    private byte mpegVersion;</TD></TR><TR><TD CLASS="l">172</TD><TD>    /**</TD></TR><TR><TD CLASS="l">173</TD><TD>     * frequency determined from MP3 Version and frequency value read from the MP3 Frame header</TD></TR><TR><TD CLASS="l">174</TD><TD>     */</TD></TR><TR><TD CLASS="l">175</TD><TD>    private double frequency;</TD></TR><TR><TD CLASS="l">176</TD><TD>    /**</TD></TR><TR><TD CLASS="l">177</TD><TD>     * bitrate calculated from the frame MP3 Frame header</TD></TR><TR><TD CLASS="l">178</TD><TD>     */</TD></TR><TR><TD CLASS="l">179</TD><TD>    private int bitRate;</TD></TR><TR><TD CLASS="l">180</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="0">181</A></TD><TD>    /**</TD></TR><TR><TD CLASS="l">182</TD><TD>     * Creates a new empty MP3File object that is not associated with a specific file.</TD></TR><TR><TD CLASS="l">183</TD><TD>     */</TD></TR><TR><TD CLASS="l">184</TD><TD>    public MP3File() {</TD></TR><TR CLASS="c"><TD CLASS="l">185</TD><TD>        super();</TD></TR><TR CLASS="c"><TD CLASS="l">186</TD><TD>    }</TD></TR><TR><TD CLASS="l">187</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="1">188</A></TD><TD>    /**</TD></TR><TR><TD CLASS="l">189</TD><TD>     * Creates a new MP3File object.</TD></TR><TR><TD CLASS="l">190</TD><TD>     */</TD></TR><TR><TD CLASS="l">191</TD><TD>    public MP3File(final MP3File copyObject) {</TD></TR><TR CLASS="z"><TD CLASS="l">192</TD><TD>        super();</TD></TR><TR CLASS="z"><TD CLASS="l">193</TD><TD>        copyProtected = copyObject.copyProtected;</TD></TR><TR CLASS="z"><TD CLASS="l">194</TD><TD>        home = copyObject.home;</TD></TR><TR CLASS="z"><TD CLASS="l">195</TD><TD>        padding = copyObject.padding;</TD></TR><TR CLASS="z"><TD CLASS="l">196</TD><TD>        privacy = copyObject.privacy;</TD></TR><TR CLASS="z"><TD CLASS="l">197</TD><TD>        protection = copyObject.protection;</TD></TR><TR CLASS="z"><TD CLASS="l">198</TD><TD>        variableBitRate = copyObject.variableBitRate;</TD></TR><TR CLASS="z"><TD CLASS="l">199</TD><TD>        emphasis = copyObject.emphasis;</TD></TR><TR CLASS="z"><TD CLASS="l">200</TD><TD>        layer = copyObject.layer;</TD></TR><TR CLASS="z"><TD CLASS="l">201</TD><TD>        mode = copyObject.mode;</TD></TR><TR CLASS="z"><TD CLASS="l">202</TD><TD>        modeExtension = copyObject.modeExtension;</TD></TR><TR CLASS="z"><TD CLASS="l">203</TD><TD>        mpegVersion = copyObject.mpegVersion;</TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>        frequency = copyObject.frequency;</TD></TR><TR CLASS="z"><TD CLASS="l">205</TD><TD>        bitRate = copyObject.bitRate;</TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>        mp3file = new File(copyObject.mp3file.getAbsolutePath());</TD></TR><TR CLASS="z"><TD CLASS="l">207</TD><TD>        filenameTag = new FilenameTag(copyObject.filenameTag);</TD></TR><TR CLASS="z"><TD CLASS="l">208</TD><TD>        id3v2tag = (AbstractID3v2) TagUtility.copyObject(copyObject.id3v2tag);</TD></TR><TR CLASS="z"><TD CLASS="l">209</TD><TD>        lyrics3tag = (AbstractLyrics3) TagUtility.copyObject(copyObject.lyrics3tag);</TD></TR><TR CLASS="z"><TD CLASS="l">210</TD><TD>        id3v1tag = (ID3v1) TagUtility.copyObject(copyObject.id3v1tag);</TD></TR><TR CLASS="z"><TD CLASS="l">211</TD><TD>    }</TD></TR><TR><TD CLASS="l">212</TD><TD> </TD></TR><TR><TD CLASS="l">213</TD><TD>    /**</TD></TR><TR><TD CLASS="l">214</TD><TD>     * Creates a new MP3File object and parse the tag from the given filename.</TD></TR><TR><TD CLASS="l">215</TD><TD>     *</TD></TR><TR><TD CLASS="l">216</TD><TD>     * @param filename MP3 file</TD></TR><TR><TD CLASS="l">217</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="2">218</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">219</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">220</TD><TD>     */</TD></TR><TR><TD CLASS="l">221</TD><TD>    public MP3File(final String filename) throws IOException, TagException {</TD></TR><TR CLASS="z"><TD CLASS="l">222</TD><TD>        this(new File(filename));</TD></TR><TR CLASS="z"><TD CLASS="l">223</TD><TD>    }</TD></TR><TR><TD CLASS="l">224</TD><TD> </TD></TR><TR><TD CLASS="l">225</TD><TD>    /**</TD></TR><TR><TD CLASS="l">226</TD><TD>     * Creates a new MP3File object and parse the tag from the given file Object.</TD></TR><TR><TD CLASS="l">227</TD><TD>     *</TD></TR><TR><TD CLASS="l">228</TD><TD>     * @param file MP3 file</TD></TR><TR><TD CLASS="l">229</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="28">230</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">231</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">232</TD><TD>     */</TD></TR><TR><TD CLASS="l">233</TD><TD>    public MP3File(final File file) throws IOException, TagException {</TD></TR><TR CLASS="c"><TD CLASS="l">234</TD><TD>        this(file, true);</TD></TR><TR CLASS="c"><TD CLASS="l">235</TD><TD>    }</TD></TR><TR><TD CLASS="l">236</TD><TD> </TD></TR><TR><TD CLASS="l">237</TD><TD>    /**</TD></TR><TR><TD CLASS="l">238</TD><TD>     * Creates a new MP3File object and parse the tag from the given file Object.</TD></TR><TR><TD CLASS="l">239</TD><TD>     *</TD></TR><TR><TD CLASS="l">240</TD><TD>     * @param file      MP3 file</TD></TR><TR><TD CLASS="l">241</TD><TD>     * @param writeable open in read (false) or read-write (true) mode</TD></TR><TR><TD CLASS="l">242</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="21">243</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">244</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">245</TD><TD>     */</TD></TR><TR><TD CLASS="l">246</TD><TD>    public MP3File(final File file, final boolean writeable) throws IOException, TagException {</TD></TR><TR CLASS="c"><TD CLASS="l">247</TD><TD>        super();</TD></TR><TR CLASS="c"><TD CLASS="l">248</TD><TD>        mp3file = file;</TD></TR><TR CLASS="p"><TD TITLE="95% line coverage (21 out of 22 instructions)" CLASS="l">249</TD><TD TITLE="95% line coverage (21 out of 22 instructions)">        final RandomAccessFile newFile = new RandomAccessFile(file, writeable ? &#34;rw&#34; : &#34;r&#34;);</TD></TR><TR><TD CLASS="l">250</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">251</TD><TD>            id3v1tag = new ID3v1_1(newFile);</TD></TR><TR CLASS="c"><TD CLASS="l">252</TD><TD>        } catch (TagNotFoundException ex) {</TD></TR><TR><TD CLASS="l">253</TD><TD>            // tag might be different version</TD></TR><TR CLASS="c"><TD CLASS="l">254</TD><TD>        }</TD></TR><TR><TD CLASS="l">255</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">256</TD><TD>            if (id3v1tag == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">257</TD><TD>                id3v1tag = new ID3v1(newFile);</TD></TR><TR><TD CLASS="l">258</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">259</TD><TD>        } catch (TagNotFoundException ex) {</TD></TR><TR><TD CLASS="l">260</TD><TD>            // ok if it's null</TD></TR><TR CLASS="c"><TD CLASS="l">261</TD><TD>        }</TD></TR><TR><TD CLASS="l">262</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">263</TD><TD>            id3v2tag = new ID3v2_4(newFile);</TD></TR><TR CLASS="c"><TD CLASS="l">264</TD><TD>        } catch (TagNotFoundException ex) {</TD></TR><TR><TD CLASS="l">265</TD><TD>            // maybe different version</TD></TR><TR CLASS="c"><TD CLASS="l">266</TD><TD>        }</TD></TR><TR><TD CLASS="l">267</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">268</TD><TD>            if (id3v2tag == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">269</TD><TD>                id3v2tag = new ID3v2_3(newFile);</TD></TR><TR><TD CLASS="l">270</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">271</TD><TD>        } catch (TagNotFoundException ex) {</TD></TR><TR><TD CLASS="l">272</TD><TD>            // maybe a different version</TD></TR><TR CLASS="c"><TD CLASS="l">273</TD><TD>        }</TD></TR><TR><TD CLASS="l">274</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">275</TD><TD>            if (id3v2tag == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">276</TD><TD>                id3v2tag = new ID3v2_2(newFile);</TD></TR><TR><TD CLASS="l">277</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">278</TD><TD>        } catch (TagNotFoundException ex) {</TD></TR><TR><TD CLASS="l">279</TD><TD>            // it's ok to be null</TD></TR><TR CLASS="c"><TD CLASS="l">280</TD><TD>        }</TD></TR><TR><TD CLASS="l">281</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">282</TD><TD>            lyrics3tag = new Lyrics3v2(newFile);</TD></TR><TR CLASS="c"><TD CLASS="l">283</TD><TD>        } catch (TagNotFoundException ex) {</TD></TR><TR><TD CLASS="l">284</TD><TD>            // maybe a different version</TD></TR><TR CLASS="c"><TD CLASS="l">285</TD><TD>        }</TD></TR><TR><TD CLASS="l">286</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">287</TD><TD>            if (lyrics3tag == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">288</TD><TD>                lyrics3tag = new Lyrics3v1(newFile);</TD></TR><TR><TD CLASS="l">289</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">290</TD><TD>        } catch (TagNotFoundException ex) {</TD></TR><TR><TD CLASS="l">291</TD><TD>            //it's ok to be null</TD></TR><TR CLASS="c"><TD CLASS="l">292</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">293</TD><TD>        newFile.close();</TD></TR><TR><TD CLASS="l">294</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">295</TD><TD>            filenameTag = FilenameTagBuilder.createFilenameTagFromMP3File(this);</TD></TR><TR CLASS="z"><TD CLASS="l">296</TD><TD>        } catch (Exception ex) {</TD></TR><TR CLASS="z"><TD CLASS="l">297</TD><TD>            throw new TagException(&#34;Unable to create FilenameTag&#34;, ex);</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="4">298</A></TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">299</TD><TD>    }</TD></TR><TR><TD CLASS="l">300</TD><TD> </TD></TR><TR><TD CLASS="l">301</TD><TD>    public int getBitRate() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="e">302</A></TD><TD>        return bitRate;</TD></TR><TR><TD CLASS="l">303</TD><TD>    }</TD></TR><TR><TD CLASS="l">304</TD><TD> </TD></TR><TR><TD CLASS="l">305</TD><TD>    public boolean isCopyProtected() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="5">306</A></TD><TD>        return copyProtected;</TD></TR><TR><TD CLASS="l">307</TD><TD>    }</TD></TR><TR><TD CLASS="l">308</TD><TD> </TD></TR><TR><TD CLASS="l">309</TD><TD>    public byte getEmphasis() {</TD></TR><TR CLASS="z"><TD CLASS="l">310</TD><TD>        return emphasis;</TD></TR><TR><TD CLASS="l">311</TD><TD>    }</TD></TR><TR><TD CLASS="l">312</TD><TD> </TD></TR><TR><TD CLASS="l">313</TD><TD>    /**</TD></TR><TR><TD CLASS="l">314</TD><TD>     * Sets the filename tag for this MP3 File. Refer to &lt;code&gt;TagUtilities.parseFileName&lt;/code&gt; and</TD></TR><TR><TD CLASS="l">315</TD><TD>     * &lt;code&gt;TagUtilities.createID3v2Tag&lt;/code&gt; for more information about parsing file names into &lt;code&gt;ID3v2_4&lt;/code&gt;</TD></TR><TR><TD CLASS="l">316</TD><TD>     * objects.</TD></TR><TR><TD CLASS="l"><A NAME="34">317</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">318</TD><TD>     * @param filenameTag parsed &lt;code&gt;ID3v2_4&lt;/code&gt; filename tag</TD></TR><TR><TD CLASS="l">319</TD><TD>     */</TD></TR><TR><TD CLASS="l">320</TD><TD>    public void setFilenameTag(final FilenameTag filenameTag) {</TD></TR><TR CLASS="c"><TD CLASS="l">321</TD><TD>        this.filenameTag = filenameTag;</TD></TR><TR CLASS="c"><TD CLASS="l">322</TD><TD>    }</TD></TR><TR><TD CLASS="l">323</TD><TD> </TD></TR><TR><TD CLASS="l">324</TD><TD>    /**</TD></TR><TR><TD CLASS="l">325</TD><TD>     * Sets the filename tag for this MP3 File. Refer to &lt;code&gt;TagUtilities.parseFileName&lt;/code&gt; and</TD></TR><TR><TD CLASS="l">326</TD><TD>     * &lt;code&gt;TagUtilities.createID3v2Tag&lt;/code&gt; for more information about parsing file names into &lt;code&gt;ID3v2_4&lt;/code&gt;</TD></TR><TR><TD CLASS="l">327</TD><TD>     * objects.</TD></TR><TR><TD CLASS="l"><A NAME="2b">328</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">329</TD><TD>     * @return parsed &lt;code&gt;ID3v2_4&lt;/code&gt; filename tag</TD></TR><TR><TD CLASS="l">330</TD><TD>     */</TD></TR><TR><TD CLASS="l">331</TD><TD>    public FilenameTag getFilenameTag() {</TD></TR><TR CLASS="c"><TD CLASS="l">332</TD><TD>        return filenameTag;</TD></TR><TR><TD CLASS="l">333</TD><TD>    }</TD></TR><TR><TD CLASS="l">334</TD><TD> </TD></TR><TR><TD CLASS="l">335</TD><TD>    /**</TD></TR><TR><TD CLASS="l">336</TD><TD>     * Sets all four (id3v1, lyrics3, filename, id3v2) tags in this instance to the &lt;code&gt;frame&lt;/code&gt; argument if the</TD></TR><TR><TD CLASS="l">337</TD><TD>     * tag exists. This method does not use the options inside the &lt;code&gt;tagOptions&lt;/code&gt; object.</TD></TR><TR><TD CLASS="l">338</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="35">339</A></TD><TD>     * @param frame frame to set / replace in all four tags.</TD></TR><TR><TD CLASS="l">340</TD><TD>     */</TD></TR><TR><TD CLASS="l">341</TD><TD>    //todo this method is very inefficient.</TD></TR><TR><TD CLASS="l">342</TD><TD>    public void setFrameAcrossTags(final AbstractID3v2Frame frame) {</TD></TR><TR CLASS="c"><TD CLASS="l">343</TD><TD>        if (id3v1tag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">344</TD><TD>            final ID3v2_4 id3v1 = new ID3v2_4(id3v1tag);</TD></TR><TR CLASS="c"><TD CLASS="l">345</TD><TD>            id3v1.setFrame(frame);</TD></TR><TR CLASS="c"><TD CLASS="l">346</TD><TD>            id3v1tag.overwrite(id3v1);</TD></TR><TR><TD CLASS="l">347</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">348</TD><TD>        if (id3v2tag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">349</TD><TD>            id3v2tag.setFrame(frame);</TD></TR><TR><TD CLASS="l">350</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">351</TD><TD>        if (lyrics3tag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">352</TD><TD>            final ID3v2_4 lyrics3 = new ID3v2_4(lyrics3tag);</TD></TR><TR CLASS="c"><TD CLASS="l">353</TD><TD>            lyrics3.setFrame(frame);</TD></TR><TR CLASS="c"><TD CLASS="l">354</TD><TD>            lyrics3tag = new Lyrics3v2(lyrics3);</TD></TR><TR><TD CLASS="l">355</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">356</TD><TD>        if (filenameTag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">357</TD><TD>            filenameTag.setFrame(frame);</TD></TR><TR><TD CLASS="l">358</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">359</TD><TD>    }</TD></TR><TR><TD CLASS="l">360</TD><TD> </TD></TR><TR><TD CLASS="l">361</TD><TD>    /**</TD></TR><TR><TD CLASS="l">362</TD><TD>     * Gets the frames from all four (id3v1, lyrics3, filename, id3v2) mp3 tags in this instance for each tag that</TD></TR><TR><TD CLASS="l">363</TD><TD>     * exists. This method does not use the options inside the &lt;code&gt;tagOptions&lt;/code&gt; object.</TD></TR><TR><TD CLASS="l">364</TD><TD>     *</TD></TR><TR><TD CLASS="l">365</TD><TD>     * @param identifier ID3v2.4 Tag Frame Identifier.</TD></TR><TR><TD CLASS="l">366</TD><TD>     *</TD></TR><TR><TD CLASS="l">367</TD><TD>     * @return ArrayList of all instances of the desired frame. Each instance is returned as an</TD></TR><TR><TD CLASS="l">368</TD><TD>     *         &lt;code&gt;ID3v2_4Frame&lt;/code&gt;. The nature of the code returns the array in a specific order, but this order</TD></TR><TR><TD CLASS="l"><A NAME="2c">369</A></TD><TD>     *         is not guaranteed for future versions of this library.</TD></TR><TR><TD CLASS="l">370</TD><TD>     */</TD></TR><TR><TD CLASS="l">371</TD><TD>    //todo this method is very inefficient.</TD></TR><TR><TD CLASS="l">372</TD><TD>    public List getFrameAcrossTags(final String identifier) {</TD></TR><TR CLASS="c"><TD CLASS="l">373</TD><TD>        if (identifier != null &amp;&amp; identifier.length() &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">374</TD><TD>            final List list = new ArrayList(32);</TD></TR><TR><TD CLASS="l">375</TD><TD>            Iterator iterator;</TD></TR><TR CLASS="c"><TD CLASS="l">376</TD><TD>            if (id3v1tag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">377</TD><TD>                final ID3v2_4 id3v1 = new ID3v2_4(id3v1tag);</TD></TR><TR CLASS="c"><TD CLASS="l">378</TD><TD>                if (id3v1.hasFrameOfType(identifier)) {</TD></TR><TR CLASS="c"><TD CLASS="l">379</TD><TD>                    iterator = id3v1.getFrameOfType(identifier);</TD></TR><TR CLASS="c"><TD CLASS="l">380</TD><TD>                    while (iterator.hasNext()) {</TD></TR><TR CLASS="c"><TD CLASS="l">381</TD><TD>                        list.add(iterator.next());</TD></TR><TR><TD CLASS="l">382</TD><TD>                    }</TD></TR><TR><TD CLASS="l">383</TD><TD>                }</TD></TR><TR><TD CLASS="l">384</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">385</TD><TD>            if (id3v2tag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">386</TD><TD>                if (id3v2tag.hasFrameOfType(identifier)) {</TD></TR><TR CLASS="c"><TD CLASS="l">387</TD><TD>                    iterator = id3v2tag.getFrameOfType(identifier);</TD></TR><TR CLASS="c"><TD CLASS="l">388</TD><TD>                    while (iterator.hasNext()) {</TD></TR><TR CLASS="c"><TD CLASS="l">389</TD><TD>                        list.add(iterator.next());</TD></TR><TR><TD CLASS="l">390</TD><TD>                    }</TD></TR><TR><TD CLASS="l">391</TD><TD>                }</TD></TR><TR><TD CLASS="l">392</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">393</TD><TD>            if (lyrics3tag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">394</TD><TD>                final ID3v2_4 lyrics3 = new ID3v2_4(lyrics3tag);</TD></TR><TR CLASS="c"><TD CLASS="l">395</TD><TD>                if (lyrics3.hasFrameOfType(identifier)) {</TD></TR><TR CLASS="c"><TD CLASS="l">396</TD><TD>                    iterator = lyrics3.getFrameOfType(identifier);</TD></TR><TR CLASS="c"><TD CLASS="l">397</TD><TD>                    while (iterator.hasNext()) {</TD></TR><TR CLASS="c"><TD CLASS="l">398</TD><TD>                        list.add(iterator.next());</TD></TR><TR><TD CLASS="l">399</TD><TD>                    }</TD></TR><TR><TD CLASS="l">400</TD><TD>                }</TD></TR><TR><TD CLASS="l">401</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">402</TD><TD>            if (filenameTag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">403</TD><TD>                if (filenameTag.hasFrameOfType(identifier)) {</TD></TR><TR CLASS="c"><TD CLASS="l">404</TD><TD>                    iterator = filenameTag.getFrameOfType(identifier);</TD></TR><TR CLASS="c"><TD CLASS="l">405</TD><TD>                    while (iterator.hasNext()) {</TD></TR><TR CLASS="c"><TD CLASS="l">406</TD><TD>                        list.add(iterator.next());</TD></TR><TR><TD CLASS="l">407</TD><TD>                    }</TD></TR><TR><TD CLASS="l">408</TD><TD>                }</TD></TR><TR><TD CLASS="l">409</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">410</TD><TD>            return list;</TD></TR><TR><TD CLASS="l">411</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="6">412</A></TD><TD>        return null;</TD></TR><TR><TD CLASS="l">413</TD><TD>    }</TD></TR><TR><TD CLASS="l">414</TD><TD> </TD></TR><TR><TD CLASS="l">415</TD><TD>    public double getFrequency() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="f">416</A></TD><TD>        return frequency;</TD></TR><TR><TD CLASS="l">417</TD><TD>    }</TD></TR><TR><TD CLASS="l">418</TD><TD> </TD></TR><TR><TD CLASS="l">419</TD><TD>    public boolean isHome() {</TD></TR><TR CLASS="z"><TD CLASS="l">420</TD><TD>        return home;</TD></TR><TR><TD CLASS="l">421</TD><TD>    }</TD></TR><TR><TD CLASS="l">422</TD><TD> </TD></TR><TR><TD CLASS="l">423</TD><TD>    /**</TD></TR><TR><TD CLASS="l">424</TD><TD>     * Sets the &lt;code&gt;ID3v1&lt;/code&gt; tag for this object. A new &lt;code&gt;ID3v1_1&lt;/code&gt; object is created from the argument</TD></TR><TR><TD CLASS="l">425</TD><TD>     * and then used here.</TD></TR><TR><TD CLASS="l"><A NAME="1a">426</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">427</TD><TD>     * @param mp3tag Any MP3Tag object can be used and will be converted into a new ID3v1_1 object.</TD></TR><TR><TD CLASS="l">428</TD><TD>     */</TD></TR><TR><TD CLASS="l">429</TD><TD>    public void setID3v1Tag(final AbstractMP3Tag mp3tag) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="36">430</A></TD><TD>        id3v1tag = new ID3v1_1(mp3tag);</TD></TR><TR CLASS="z"><TD CLASS="l">431</TD><TD>    }</TD></TR><TR><TD CLASS="l">432</TD><TD> </TD></TR><TR><TD CLASS="l">433</TD><TD>    public void setID3v1Tag(final ID3v1 id3v1tag) {</TD></TR><TR CLASS="c"><TD CLASS="l">434</TD><TD>        this.id3v1tag = id3v1tag;</TD></TR><TR CLASS="c"><TD CLASS="l">435</TD><TD>    }</TD></TR><TR><TD CLASS="l">436</TD><TD> </TD></TR><TR><TD CLASS="l">437</TD><TD>    /**</TD></TR><TR><TD CLASS="l">438</TD><TD>     * Returns the &lt;code&gt;ID3v1&lt;/code&gt; tag for this object.</TD></TR><TR><TD CLASS="l"><A NAME="2d">439</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">440</TD><TD>     * @return the &lt;code&gt;ID3v1&lt;/code&gt; tag for this object</TD></TR><TR><TD CLASS="l">441</TD><TD>     */</TD></TR><TR><TD CLASS="l">442</TD><TD>    public ID3v1 getID3v1Tag() {</TD></TR><TR CLASS="c"><TD CLASS="l">443</TD><TD>        return id3v1tag;</TD></TR><TR><TD CLASS="l">444</TD><TD>    }</TD></TR><TR><TD CLASS="l">445</TD><TD> </TD></TR><TR><TD CLASS="l">446</TD><TD>    /**</TD></TR><TR><TD CLASS="l">447</TD><TD>     * Sets the &lt;code&gt;ID3v2&lt;/code&gt; tag for this object. A new &lt;code&gt;ID3v2_4&lt;/code&gt; object is created from the argument</TD></TR><TR><TD CLASS="l">448</TD><TD>     * and then used here.</TD></TR><TR><TD CLASS="l"><A NAME="1b">449</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">450</TD><TD>     * @param mp3tag Any MP3Tag object can be used and will be converted into a new ID3v2_4 object.</TD></TR><TR><TD CLASS="l">451</TD><TD>     */</TD></TR><TR><TD CLASS="l">452</TD><TD>    public void setID3v2Tag(final AbstractMP3Tag mp3tag) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="37">453</A></TD><TD>        id3v2tag = new ID3v2_4(mp3tag);</TD></TR><TR CLASS="z"><TD CLASS="l">454</TD><TD>    }</TD></TR><TR><TD CLASS="l">455</TD><TD> </TD></TR><TR><TD CLASS="l">456</TD><TD>    public void setID3v2Tag(final AbstractID3v2 id3v2tag) {</TD></TR><TR CLASS="c"><TD CLASS="l">457</TD><TD>        this.id3v2tag = id3v2tag;</TD></TR><TR CLASS="c"><TD CLASS="l">458</TD><TD>    }</TD></TR><TR><TD CLASS="l">459</TD><TD> </TD></TR><TR><TD CLASS="l">460</TD><TD>    /**</TD></TR><TR><TD CLASS="l">461</TD><TD>     * Returns the &lt;code&gt;ID3v2&lt;/code&gt; tag for this object.</TD></TR><TR><TD CLASS="l"><A NAME="2e">462</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">463</TD><TD>     * @return the &lt;code&gt;ID3v2&lt;/code&gt; tag for this object</TD></TR><TR><TD CLASS="l">464</TD><TD>     */</TD></TR><TR><TD CLASS="l">465</TD><TD>    public AbstractID3v2 getID3v2Tag() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="7">466</A></TD><TD>        return id3v2tag;</TD></TR><TR><TD CLASS="l">467</TD><TD>    }</TD></TR><TR><TD CLASS="l">468</TD><TD> </TD></TR><TR><TD CLASS="l">469</TD><TD>    public byte getLayer() {</TD></TR><TR CLASS="z"><TD CLASS="l">470</TD><TD>        return layer;</TD></TR><TR><TD CLASS="l">471</TD><TD>    }</TD></TR><TR><TD CLASS="l">472</TD><TD> </TD></TR><TR><TD CLASS="l">473</TD><TD>    /**</TD></TR><TR><TD CLASS="l">474</TD><TD>     * Sets the &lt;code&gt;Lyrics3&lt;/code&gt; tag for this object. A new &lt;code&gt;Lyrics3v2&lt;/code&gt; object is created from the</TD></TR><TR><TD CLASS="l">475</TD><TD>     * argument and then used here.</TD></TR><TR><TD CLASS="l"><A NAME="1c">476</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">477</TD><TD>     * @param mp3tag Any MP3Tag object can be used and will be converted into a new Lyrics3v2 object.</TD></TR><TR><TD CLASS="l">478</TD><TD>     */</TD></TR><TR><TD CLASS="l">479</TD><TD>    public void setLyrics3Tag(final AbstractMP3Tag mp3tag) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="38">480</A></TD><TD>        lyrics3tag = new Lyrics3v2(mp3tag);</TD></TR><TR CLASS="z"><TD CLASS="l">481</TD><TD>    }</TD></TR><TR><TD CLASS="l">482</TD><TD> </TD></TR><TR><TD CLASS="l">483</TD><TD>    public void setLyrics3Tag(final AbstractLyrics3 lyrics3tag) {</TD></TR><TR CLASS="c"><TD CLASS="l">484</TD><TD>        this.lyrics3tag = lyrics3tag;</TD></TR><TR CLASS="c"><TD CLASS="l">485</TD><TD>    }</TD></TR><TR><TD CLASS="l">486</TD><TD> </TD></TR><TR><TD CLASS="l">487</TD><TD>    /**</TD></TR><TR><TD CLASS="l">488</TD><TD>     * Returns the &lt;code&gt;ID3v1&lt;/code&gt; tag for this object.</TD></TR><TR><TD CLASS="l"><A NAME="2f">489</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">490</TD><TD>     * @return the &lt;code&gt;ID3v1&lt;/code&gt; tag for this object</TD></TR><TR><TD CLASS="l">491</TD><TD>     */</TD></TR><TR><TD CLASS="l">492</TD><TD>    public AbstractLyrics3 getLyrics3Tag() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="8">493</A></TD><TD>        return lyrics3tag;</TD></TR><TR><TD CLASS="l">494</TD><TD>    }</TD></TR><TR><TD CLASS="l">495</TD><TD> </TD></TR><TR><TD CLASS="l">496</TD><TD>    public byte getMode() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="9">497</A></TD><TD>        return mode;</TD></TR><TR><TD CLASS="l">498</TD><TD>    }</TD></TR><TR><TD CLASS="l">499</TD><TD> </TD></TR><TR><TD CLASS="l">500</TD><TD>    public byte getModeExtension() {</TD></TR><TR CLASS="z"><TD CLASS="l">501</TD><TD>        return modeExtension;</TD></TR><TR><TD CLASS="l">502</TD><TD>    }</TD></TR><TR><TD CLASS="l">503</TD><TD> </TD></TR><TR><TD CLASS="l">504</TD><TD>    /**</TD></TR><TR><TD CLASS="l">505</TD><TD>     * Returns the byte position of the first MP3 Frame that this object refers to. This is the first byte of music data</TD></TR><TR><TD CLASS="l">506</TD><TD>     * and not the ID3 Tag Frame.</TD></TR><TR><TD CLASS="l">507</TD><TD>     *</TD></TR><TR><TD CLASS="l">508</TD><TD>     * @return the byte position of the first MP3 Frame</TD></TR><TR><TD CLASS="l">509</TD><TD>     *</TD></TR><TR><TD CLASS="l">510</TD><TD>     * @throws IOException           on any I/O error</TD></TR><TR><TD CLASS="l"><A NAME="30">511</A></TD><TD>     * @throws FileNotFoundException if the file exists but is a directory rather than a regular file or cannot be</TD></TR><TR><TD CLASS="l">512</TD><TD>     *                               opened for any other reason</TD></TR><TR><TD CLASS="l">513</TD><TD>     */</TD></TR><TR><TD CLASS="l">514</TD><TD>    public long getMp3StartByte() throws IOException, FileNotFoundException {</TD></TR><TR CLASS="c"><TD CLASS="l">515</TD><TD>        return getMp3StartByte(mp3file);</TD></TR><TR><TD CLASS="l">516</TD><TD>    }</TD></TR><TR><TD CLASS="l">517</TD><TD> </TD></TR><TR><TD CLASS="l">518</TD><TD>    /**</TD></TR><TR><TD CLASS="l">519</TD><TD>     * Returns the byte position of the first MP3 Frame that the &lt;code&gt;file&lt;/code&gt; arguement refers to. This is the</TD></TR><TR><TD CLASS="l">520</TD><TD>     * first byte of music data and not the ID3 Tag Frame.</TD></TR><TR><TD CLASS="l">521</TD><TD>     *</TD></TR><TR><TD CLASS="l">522</TD><TD>     * @param file MP3 file to search</TD></TR><TR><TD CLASS="l">523</TD><TD>     *</TD></TR><TR><TD CLASS="l">524</TD><TD>     * @return the byte position of the first MP3 Frame</TD></TR><TR><TD CLASS="l">525</TD><TD>     *</TD></TR><TR><TD CLASS="l">526</TD><TD>     * @throws IOException           on any I/O error</TD></TR><TR><TD CLASS="l"><A NAME="1f">527</A></TD><TD>     * @throws FileNotFoundException if the file exists but is a directory rather than a regular file or cannot be</TD></TR><TR><TD CLASS="l">528</TD><TD>     *                               opened for any other reason</TD></TR><TR><TD CLASS="l">529</TD><TD>     */</TD></TR><TR><TD CLASS="l">530</TD><TD>    public long getMp3StartByte(final File file) throws IOException, FileNotFoundException {</TD></TR><TR CLASS="c"><TD CLASS="l">531</TD><TD>        RandomAccessFile rfile = null;</TD></TR><TR CLASS="c"><TD CLASS="l">532</TD><TD>        long startByte = 0L;</TD></TR><TR><TD CLASS="l">533</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">534</TD><TD>            rfile = new RandomAccessFile(file, &#34;r&#34;);</TD></TR><TR CLASS="c"><TD CLASS="l">535</TD><TD>            seekMP3Frame(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">536</TD><TD>            startByte = rfile.getFilePointer();</TD></TR><TR><TD CLASS="l">537</TD><TD>        } finally {</TD></TR><TR CLASS="p"><TD TITLE="86% line coverage (19 out of 22 instructions)" CLASS="l">538</TD><TD TITLE="86% line coverage (19 out of 22 instructions)">            if (rfile != null) {</TD></TR><TR CLASS="p"><TD TITLE="43% line coverage (3 out of 7 instructions)" CLASS="l">539</TD><TD TITLE="43% line coverage (3 out of 7 instructions)">                rfile.close();</TD></TR><TR><TD CLASS="l">540</TD><TD>            }</TD></TR><TR><TD CLASS="l">541</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="39">542</A></TD><TD>        return startByte;</TD></TR><TR><TD CLASS="l">543</TD><TD>    }</TD></TR><TR><TD CLASS="l">544</TD><TD> </TD></TR><TR><TD CLASS="l">545</TD><TD>    public void setMp3file(final File mp3file) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="31">546</A></TD><TD>        this.mp3file = mp3file;</TD></TR><TR CLASS="c"><TD CLASS="l">547</TD><TD>    }</TD></TR><TR><TD CLASS="l">548</TD><TD> </TD></TR><TR><TD CLASS="l">549</TD><TD>    public File getMp3file() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="a">550</A></TD><TD>        return mp3file;</TD></TR><TR><TD CLASS="l">551</TD><TD>    }</TD></TR><TR><TD CLASS="l">552</TD><TD> </TD></TR><TR><TD CLASS="l">553</TD><TD>    public byte getMpegVersion() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="10">554</A></TD><TD>        return mpegVersion;</TD></TR><TR><TD CLASS="l">555</TD><TD>    }</TD></TR><TR><TD CLASS="l">556</TD><TD> </TD></TR><TR><TD CLASS="l">557</TD><TD>    public boolean isPadding() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="11">558</A></TD><TD>        return padding;</TD></TR><TR><TD CLASS="l">559</TD><TD>    }</TD></TR><TR><TD CLASS="l">560</TD><TD> </TD></TR><TR><TD CLASS="l">561</TD><TD>    public boolean isPrivacy() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="12">562</A></TD><TD>        return privacy;</TD></TR><TR><TD CLASS="l">563</TD><TD>    }</TD></TR><TR><TD CLASS="l">564</TD><TD> </TD></TR><TR><TD CLASS="l">565</TD><TD>    public boolean isProtection() {</TD></TR><TR CLASS="z"><TD CLASS="l">566</TD><TD>        return protection;</TD></TR><TR><TD CLASS="l">567</TD><TD>    }</TD></TR><TR><TD CLASS="l">568</TD><TD> </TD></TR><TR><TD CLASS="l">569</TD><TD>    /**</TD></TR><TR><TD CLASS="l">570</TD><TD>     * Returns true if there are any unsynchronized tags in this object. A fragment is unsynchronized if it exists in</TD></TR><TR><TD CLASS="l">571</TD><TD>     * two or more tags but is not equal across all of them.</TD></TR><TR><TD CLASS="l">572</TD><TD>     *</TD></TR><TR><TD CLASS="l">573</TD><TD>     * @return true of any fragments are unsynchronized.</TD></TR><TR><TD CLASS="l"><A NAME="13">574</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">575</TD><TD>    //todo there might be a faster way to do this, other than calling</TD></TR><TR><TD CLASS="l">576</TD><TD>    //getUnsynchronizedFragments()</TD></TR><TR><TD CLASS="l">577</TD><TD>    public boolean isUnsynchronized() {</TD></TR><TR CLASS="z"><TD CLASS="l">578</TD><TD>        return getUnsynchronizedFragments().size() &gt; 0;</TD></TR><TR><TD CLASS="l">579</TD><TD>    }</TD></TR><TR><TD CLASS="l">580</TD><TD> </TD></TR><TR><TD CLASS="l">581</TD><TD>    /**</TD></TR><TR><TD CLASS="l">582</TD><TD>     * Returns a HashSet of unsynchronized fragments across all tags in this object. A fragment is unsynchronized if it</TD></TR><TR><TD CLASS="l">583</TD><TD>     * exists in two or more tags but is not equal across all of them.</TD></TR><TR><TD CLASS="l"><A NAME="26">584</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">585</TD><TD>     * @return a HashSet of unsynchronized fragments</TD></TR><TR><TD CLASS="l">586</TD><TD>     */</TD></TR><TR><TD CLASS="l">587</TD><TD>    public Set getUnsynchronizedFragments() {</TD></TR><TR CLASS="c"><TD CLASS="l">588</TD><TD>        final ID3v2_4 total = new ID3v2_4(id3v2tag);</TD></TR><TR CLASS="c"><TD CLASS="l">589</TD><TD>        final Set set = new HashSet(32);</TD></TR><TR CLASS="c"><TD CLASS="l">590</TD><TD>        total.append(id3v1tag);</TD></TR><TR CLASS="c"><TD CLASS="l">591</TD><TD>        total.append(lyrics3tag);</TD></TR><TR CLASS="c"><TD CLASS="l">592</TD><TD>        total.append(filenameTag);</TD></TR><TR CLASS="c"><TD CLASS="l">593</TD><TD>        total.append(id3v2tag);</TD></TR><TR CLASS="c"><TD CLASS="l">594</TD><TD>        final ID3v2_4 id3v1 = new ID3v2_4(id3v1tag);</TD></TR><TR CLASS="c"><TD CLASS="l">595</TD><TD>        final ID3v2_4 lyrics3 = new ID3v2_4(lyrics3tag);</TD></TR><TR CLASS="c"><TD CLASS="l">596</TD><TD>        final ID3v2_4 filename = new ID3v2_4(filenameTag);</TD></TR><TR CLASS="c"><TD CLASS="l">597</TD><TD>        final AbstractID3v2 id3v2 = id3v2tag;</TD></TR><TR CLASS="c"><TD CLASS="l">598</TD><TD>        final Iterator iterator = total.iterator();</TD></TR><TR CLASS="c"><TD CLASS="l">599</TD><TD>        while (iterator.hasNext()) {</TD></TR><TR CLASS="c"><TD CLASS="l">600</TD><TD>            final AbstractID3v2Frame frame = (AbstractID3v2Frame) iterator.next();</TD></TR><TR CLASS="c"><TD CLASS="l">601</TD><TD>            final String identifier = frame.getIdentifier();</TD></TR><TR CLASS="c"><TD CLASS="l">602</TD><TD>            if (id3v2 != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">603</TD><TD>                if (id3v2.hasFrame(identifier)) {</TD></TR><TR CLASS="c"><TD CLASS="l">604</TD><TD>                    if (!id3v2.getFrame(identifier).isSubsetOf(frame)) {</TD></TR><TR CLASS="z"><TD CLASS="l">605</TD><TD>                        set.add(identifier);</TD></TR><TR><TD CLASS="l">606</TD><TD>                    }</TD></TR><TR><TD CLASS="l">607</TD><TD>                }</TD></TR><TR><TD CLASS="l">608</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">609</TD><TD>            if (id3v1.hasFrame(identifier)) {</TD></TR><TR CLASS="c"><TD CLASS="l">610</TD><TD>                if (!id3v1.getFrame(identifier).isSubsetOf(frame)) {</TD></TR><TR CLASS="c"><TD CLASS="l">611</TD><TD>                    set.add(identifier);</TD></TR><TR><TD CLASS="l">612</TD><TD>                }</TD></TR><TR><TD CLASS="l">613</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">614</TD><TD>            if (lyrics3.hasFrame(identifier)) {</TD></TR><TR CLASS="c"><TD CLASS="l">615</TD><TD>                if (!lyrics3.getFrame(identifier).isSubsetOf(frame)) {</TD></TR><TR CLASS="c"><TD CLASS="l">616</TD><TD>                    set.add(identifier);</TD></TR><TR><TD CLASS="l">617</TD><TD>                }</TD></TR><TR><TD CLASS="l">618</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">619</TD><TD>            if (filename.hasFrame(identifier)) {</TD></TR><TR CLASS="c"><TD CLASS="l">620</TD><TD>                if (!filename.getFrame(identifier).isSubsetOf(frame)) {</TD></TR><TR CLASS="c"><TD CLASS="l">621</TD><TD>                    set.add(identifier);</TD></TR><TR><TD CLASS="l">622</TD><TD>                }</TD></TR><TR><TD CLASS="l">623</TD><TD>            }</TD></TR><TR><TD CLASS="l">624</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="1d">625</A></TD><TD>        return set;</TD></TR><TR><TD CLASS="l">626</TD><TD>    }</TD></TR><TR><TD CLASS="l">627</TD><TD> </TD></TR><TR><TD CLASS="l">628</TD><TD>    public void setVariableBitRate(final boolean variableBitRate) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="14">629</A></TD><TD>        this.variableBitRate = variableBitRate;</TD></TR><TR CLASS="z"><TD CLASS="l">630</TD><TD>    }</TD></TR><TR><TD CLASS="l">631</TD><TD> </TD></TR><TR><TD CLASS="l">632</TD><TD>    public boolean isVariableBitRate() {</TD></TR><TR CLASS="z"><TD CLASS="l">633</TD><TD>        return variableBitRate;</TD></TR><TR><TD CLASS="l">634</TD><TD>    }</TD></TR><TR><TD CLASS="l">635</TD><TD> </TD></TR><TR><TD CLASS="l">636</TD><TD>    /**</TD></TR><TR><TD CLASS="l">637</TD><TD>     * Adjust the lenght of the ID3v2 padding at the beginning of the MP3 file referred to in this object. The ID3v2</TD></TR><TR><TD CLASS="l">638</TD><TD>     * size will be calculated, then a new file will be created with enough size to fit the &lt;code&gt;ID3v2&lt;/code&gt; tag in</TD></TR><TR><TD CLASS="l">639</TD><TD>     * this object. The old file will be deleted, and the new file renamed. All parameters will be taken from the</TD></TR><TR><TD CLASS="l">640</TD><TD>     * &lt;code&gt;tagOptions&lt;/code&gt; object.</TD></TR><TR><TD CLASS="l">641</TD><TD>     *</TD></TR><TR><TD CLASS="l">642</TD><TD>     * @throws FileNotFoundException if the file exists but is a directory rather than a regular file or cannot be</TD></TR><TR><TD CLASS="l">643</TD><TD>     *                               opened for any other reason</TD></TR><TR><TD CLASS="l"><A NAME="29">644</A></TD><TD>     * @throws IOException           on any I/O error</TD></TR><TR><TD CLASS="l">645</TD><TD>     * @throws TagException          on any exception generated by this library.</TD></TR><TR><TD CLASS="l">646</TD><TD>     */</TD></TR><TR><TD CLASS="l">647</TD><TD>    public boolean adjustID3v2Padding() throws FileNotFoundException, IOException, TagException {</TD></TR><TR CLASS="c"><TD CLASS="l">648</TD><TD>        return adjustID3v2Padding(TagOptionSingleton.getInstance().getId3v2PaddingSize(),</TD></TR><TR><TD CLASS="l">649</TD><TD>                                  TagOptionSingleton.getInstance().isId3v2PaddingWillShorten(),</TD></TR><TR><TD CLASS="l">650</TD><TD>                                  TagOptionSingleton.getInstance().isId3v2PaddingCopyTag(),</TD></TR><TR><TD CLASS="l">651</TD><TD>                                  mp3file);</TD></TR><TR><TD CLASS="l">652</TD><TD>    }</TD></TR><TR><TD CLASS="l">653</TD><TD> </TD></TR><TR><TD CLASS="l">654</TD><TD>    /**</TD></TR><TR><TD CLASS="l">655</TD><TD>     * Adjust the length of the ID3v2 padding at the beginning of the MP3 file this object refers to. The ID3v2 size</TD></TR><TR><TD CLASS="l">656</TD><TD>     * will be calculated, then a new file will be created with enough size to fit the &lt;code&gt;ID3v2&lt;/code&gt; tag. The old</TD></TR><TR><TD CLASS="l">657</TD><TD>     * file will be deleted, and the new file renamed.</TD></TR><TR><TD CLASS="l">658</TD><TD>     *</TD></TR><TR><TD CLASS="l">659</TD><TD>     * @param paddingSize  Initial padding size. This size is doubled until the ID3v2 tag will fit.</TD></TR><TR><TD CLASS="l">660</TD><TD>     * @param willShorten  if the newly calculated padding size is less than the padding length of the file, then news</TD></TR><TR><TD CLASS="l">661</TD><TD>     *                     the new shorter padding size if this is true.</TD></TR><TR><TD CLASS="l">662</TD><TD>     * @param copyID3v2Tag if true, write the &lt;code&gt;ID3v2&lt;/code&gt; tag of this object into the file</TD></TR><TR><TD CLASS="l">663</TD><TD>     *</TD></TR><TR><TD CLASS="l">664</TD><TD>     * @throws FileNotFoundException if the file exists but is a directory rather than a regular file or cannot be</TD></TR><TR><TD CLASS="l">665</TD><TD>     *                               opened for any other reason</TD></TR><TR><TD CLASS="l">666</TD><TD>     * @throws IOException           on any I/O error</TD></TR><TR><TD CLASS="l"><A NAME="2a">667</A></TD><TD>     * @throws TagException          on any exception generated by this library.</TD></TR><TR><TD CLASS="l">668</TD><TD>     */</TD></TR><TR><TD CLASS="l">669</TD><TD>    public boolean adjustID3v2Padding(final int paddingSize, final boolean willShorten, final boolean copyID3v2Tag)</TD></TR><TR><TD CLASS="l">670</TD><TD>            throws FileNotFoundException, IOException, TagException {</TD></TR><TR CLASS="c"><TD CLASS="l">671</TD><TD>        return adjustID3v2Padding(paddingSize, willShorten, copyID3v2Tag, mp3file);</TD></TR><TR><TD CLASS="l">672</TD><TD>    }</TD></TR><TR><TD CLASS="l">673</TD><TD> </TD></TR><TR><TD CLASS="l">674</TD><TD>    /**</TD></TR><TR><TD CLASS="l">675</TD><TD>     * Adjust the length of the ID3v2 padding at the beginning of the MP3 file this object refers to. The ID3v2 size</TD></TR><TR><TD CLASS="l">676</TD><TD>     * will be calculated, then a new file will be created with enough size to fit the &lt;code&gt;ID3v2&lt;/code&gt; tag. The old</TD></TR><TR><TD CLASS="l">677</TD><TD>     * file will be deleted, and the new file renamed.</TD></TR><TR><TD CLASS="l">678</TD><TD>     *</TD></TR><TR><TD CLASS="l">679</TD><TD>     * @param paddingSize  Initial padding size. This size is doubled until the ID3v2 tag will fit. A paddingSize of</TD></TR><TR><TD CLASS="l">680</TD><TD>     *                     zero will create a padding length exactly equal to the tag size.</TD></TR><TR><TD CLASS="l">681</TD><TD>     * @param willShorten  Shorten the padding size by halves if the ID3v2 tag will fit</TD></TR><TR><TD CLASS="l">682</TD><TD>     * @param copyID3v2Tag if true, write the &lt;code&gt;ID3v2&lt;/code&gt; tag of this object into the file</TD></TR><TR><TD CLASS="l">683</TD><TD>     * @param file         The file to adjust the padding length of</TD></TR><TR><TD CLASS="l">684</TD><TD>     *</TD></TR><TR><TD CLASS="l">685</TD><TD>     * @throws FileNotFoundException if the file exists but is a directory rather than a regular file or cannot be</TD></TR><TR><TD CLASS="l">686</TD><TD>     *                               opened for any other reason</TD></TR><TR><TD CLASS="l">687</TD><TD>     * @throws IOException           on any I/O error</TD></TR><TR><TD CLASS="l">688</TD><TD>     * @throws TagException          on any exception generated by this library.</TD></TR><TR><TD CLASS="l">689</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="24">690</A></TD><TD>    public boolean adjustID3v2Padding(final int paddingSize,</TD></TR><TR><TD CLASS="l">691</TD><TD>                                      final boolean willShorten,</TD></TR><TR><TD CLASS="l">692</TD><TD>                                      final boolean copyID3v2Tag,</TD></TR><TR><TD CLASS="l">693</TD><TD>                                      final File file) throws FileNotFoundException, IOException, TagException {</TD></TR><TR CLASS="c"><TD CLASS="l">694</TD><TD>        int id3v2TagSize = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">695</TD><TD>        final long mp3start = getMp3StartByte(file);</TD></TR><TR CLASS="c"><TD CLASS="l">696</TD><TD>        long newPaddingSize = paddingSize;</TD></TR><TR CLASS="c"><TD CLASS="l">697</TD><TD>        FileOutputStream outStream = null;</TD></TR><TR CLASS="c"><TD CLASS="l">698</TD><TD>        FileInputStream inStream = null;</TD></TR><TR CLASS="c"><TD CLASS="l">699</TD><TD>        File backupFile = null;</TD></TR><TR CLASS="c"><TD CLASS="l">700</TD><TD>        File paddedFile = null;</TD></TR><TR CLASS="c"><TD CLASS="l">701</TD><TD>        if (newPaddingSize &lt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">702</TD><TD>            throw new TagException(&#34;Invalid paddingSize: &#34; + newPaddingSize);</TD></TR><TR><TD CLASS="l">703</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">704</TD><TD>        if (hasID3v2Tag()) {</TD></TR><TR CLASS="c"><TD CLASS="l">705</TD><TD>            id3v2TagSize = getID3v2Tag().getSize();</TD></TR><TR><TD CLASS="l">706</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">707</TD><TD>        if (newPaddingSize != 0) {</TD></TR><TR><TD CLASS="l">708</TD><TD>            // double padding size until it's large enough</TD></TR><TR CLASS="c"><TD CLASS="l">709</TD><TD>            while (newPaddingSize &lt; id3v2TagSize) {</TD></TR><TR CLASS="c"><TD CLASS="l">710</TD><TD>                newPaddingSize *= TagOptionSingleton.getInstance().getId3v2PaddingMultiplier();</TD></TR><TR><TD CLASS="l">711</TD><TD>            }</TD></TR><TR><TD CLASS="l">712</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">713</TD><TD>        if (newPaddingSize &lt; mp3start &amp;&amp; !willShorten) {</TD></TR><TR CLASS="c"><TD CLASS="l">714</TD><TD>            return false;</TD></TR><TR><TD CLASS="l">715</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">716</TD><TD>        if (newPaddingSize == mp3start) {</TD></TR><TR CLASS="c"><TD CLASS="l">717</TD><TD>            return false;</TD></TR><TR><TD CLASS="l">718</TD><TD>        }</TD></TR><TR><TD CLASS="l">719</TD><TD>        try {</TD></TR><TR><TD CLASS="l">720</TD><TD>            // we first copy everything to a new file, then replace the original</TD></TR><TR CLASS="c"><TD CLASS="l">721</TD><TD>            paddedFile = File.createTempFile(&#34;temp&#34;, &#34;.mp3&#34;, file.getParentFile());</TD></TR><TR CLASS="c"><TD CLASS="l">722</TD><TD>            outStream = new FileOutputStream(paddedFile);</TD></TR><TR CLASS="c"><TD CLASS="l">723</TD><TD>            inStream = new FileInputStream(file);</TD></TR><TR><TD CLASS="l">724</TD><TD>            byte[] buffer;</TD></TR><TR CLASS="c"><TD CLASS="l">725</TD><TD>            if (copyID3v2Tag == true) {</TD></TR><TR><TD CLASS="l">726</TD><TD>                // paddingSize &lt; mp3start &amp;&amp; willshorten == false</TD></TR><TR><TD CLASS="l">727</TD><TD>                // was already checked for outside of the try block.</TD></TR><TR CLASS="c"><TD CLASS="l">728</TD><TD>                if ((newPaddingSize &lt; mp3start) &amp;&amp; willShorten) {</TD></TR><TR><TD CLASS="l">729</TD><TD>                    // copy the current tag</TD></TR><TR CLASS="c"><TD CLASS="l">730</TD><TD>                    buffer = new byte[(int) newPaddingSize];</TD></TR><TR CLASS="c"><TD CLASS="l">731</TD><TD>                    inStream.read(buffer, 0, buffer.length);</TD></TR><TR CLASS="c"><TD CLASS="l">732</TD><TD>                    outStream.write(buffer, 0, buffer.length);</TD></TR><TR CLASS="c"><TD CLASS="l">733</TD><TD>                    buffer = new byte[(int) (mp3start - newPaddingSize)];</TD></TR><TR><TD CLASS="l">734</TD><TD> </TD></TR><TR><TD CLASS="l">735</TD><TD>                    // skip the rest of the tag that didn't fit</TD></TR><TR CLASS="c"><TD CLASS="l">736</TD><TD>                    inStream.read(buffer, 0, buffer.length);</TD></TR><TR><TD CLASS="l">737</TD><TD> </TD></TR><TR><TD CLASS="l">738</TD><TD>                    // paddingSize &gt; mp3start</TD></TR><TR><TD CLASS="l">739</TD><TD>                } else {</TD></TR><TR><TD CLASS="l">740</TD><TD>                    // copy the current tag</TD></TR><TR CLASS="c"><TD CLASS="l">741</TD><TD>                    buffer = new byte[(int) mp3start];</TD></TR><TR CLASS="c"><TD CLASS="l">742</TD><TD>                    inStream.read(buffer, 0, buffer.length);</TD></TR><TR CLASS="c"><TD CLASS="l">743</TD><TD>                    outStream.write(buffer, 0, buffer.length);</TD></TR><TR><TD CLASS="l">744</TD><TD> </TD></TR><TR><TD CLASS="l">745</TD><TD>                    // add zeros for the rest of the padding</TD></TR><TR CLASS="c"><TD CLASS="l">746</TD><TD>                    if (newPaddingSize - mp3start &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">747</TD><TD>                        buffer = new byte[(int) (newPaddingSize - mp3start)];</TD></TR><TR CLASS="c"><TD CLASS="l">748</TD><TD>                        outStream.write(buffer, 0, buffer.length);</TD></TR><TR><TD CLASS="l">749</TD><TD>                    }</TD></TR><TR><TD CLASS="l">750</TD><TD>                }</TD></TR><TR><TD CLASS="l">751</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">752</TD><TD>                buffer = new byte[(int) newPaddingSize];</TD></TR><TR><TD CLASS="l">753</TD><TD> </TD></TR><TR><TD CLASS="l">754</TD><TD>                // skip the tag</TD></TR><TR CLASS="c"><TD CLASS="l">755</TD><TD>                inStream.skip(mp3start);</TD></TR><TR><TD CLASS="l">756</TD><TD> </TD></TR><TR><TD CLASS="l">757</TD><TD>                // write zeros for the tag</TD></TR><TR CLASS="c"><TD CLASS="l">758</TD><TD>                outStream.write(buffer, 0, buffer.length);</TD></TR><TR><TD CLASS="l">759</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">760</TD><TD>            buffer = new byte[1024];</TD></TR><TR CLASS="c"><TD CLASS="l">761</TD><TD>            int b = inStream.read(buffer, 0, buffer.length);</TD></TR><TR CLASS="c"><TD CLASS="l">762</TD><TD>            while (b == 1024) {</TD></TR><TR CLASS="c"><TD CLASS="l">763</TD><TD>                outStream.write(buffer, 0, buffer.length);</TD></TR><TR CLASS="c"><TD CLASS="l">764</TD><TD>                b = inStream.read(buffer, 0, buffer.length);</TD></TR><TR><TD CLASS="l">765</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">766</TD><TD>            if (b != -1) {</TD></TR><TR CLASS="c"><TD CLASS="l">767</TD><TD>                outStream.write(buffer, 0, b);</TD></TR><TR><TD CLASS="l">768</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">769</TD><TD>            backupFile = new File(file.getParentFile(), TagUtility.appendBeforeExtension(file.getName(), &#34;.original&#34;));</TD></TR><TR CLASS="c"><TD CLASS="l">770</TD><TD>            TagUtility.copyFile(file, backupFile);</TD></TR><TR CLASS="c"><TD CLASS="l">771</TD><TD>            if (backupFile.exists()) {</TD></TR><TR CLASS="c"><TD CLASS="l">772</TD><TD>                backupFile.setLastModified(file.lastModified());</TD></TR><TR><TD CLASS="l">773</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">774</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">775</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">776</TD><TD>            TagUtility.copyFile(paddedFile, file);</TD></TR><TR CLASS="c"><TD CLASS="l">777</TD><TD>            return true;</TD></TR><TR><TD CLASS="l">778</TD><TD>        } finally {</TD></TR><TR CLASS="p"><TD TITLE="43% line coverage (3 out of 7 instructions)" CLASS="l">779</TD><TD TITLE="43% line coverage (3 out of 7 instructions)">            if (inStream != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">780</TD><TD>                inStream.getFD().sync();</TD></TR><TR CLASS="c"><TD CLASS="l">781</TD><TD>                inStream.close();</TD></TR><TR><TD CLASS="l">782</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">783</TD><TD>            if (outStream != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">784</TD><TD>                outStream.getFD().sync();</TD></TR><TR CLASS="c"><TD CLASS="l">785</TD><TD>                outStream.close();</TD></TR><TR><TD CLASS="l">786</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">787</TD><TD>            if ((backupFile != null) &amp;&amp;</TD></TR><TR><TD CLASS="l">788</TD><TD>                (TagOptionSingleton.getInstance().isOriginalSavedAfterAdjustingID3v2Padding() == false)) {</TD></TR><TR CLASS="z"><TD CLASS="l">789</TD><TD>                backupFile.delete();</TD></TR><TR><TD CLASS="l">790</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">791</TD><TD>            if (paddedFile != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">792</TD><TD>                paddedFile.delete();</TD></TR><TR><TD CLASS="l">793</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="3">794</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">795</TD><TD>    }</TD></TR><TR><TD CLASS="l">796</TD><TD> </TD></TR><TR><TD CLASS="l">797</TD><TD>    public void delete(final AbstractMP3Tag mp3tag) throws FileNotFoundException, IOException {</TD></TR><TR CLASS="z"><TD CLASS="l">798</TD><TD>        mp3tag.delete(new RandomAccessFile(mp3file, &#34;rw&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">799</TD><TD>    }</TD></TR><TR><TD CLASS="l">800</TD><TD> </TD></TR><TR><TD CLASS="l">801</TD><TD>    /**</TD></TR><TR><TD CLASS="l">802</TD><TD>     * Returns true if this object contains an filename pseudo-tag</TD></TR><TR><TD CLASS="l"><A NAME="b">803</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">804</TD><TD>     * @return true if this object contains an filename pseudo-tag</TD></TR><TR><TD CLASS="l">805</TD><TD>     */</TD></TR><TR><TD CLASS="l">806</TD><TD>    public boolean hasFilenameTag() {</TD></TR><TR CLASS="z"><TD CLASS="l">807</TD><TD>        return (filenameTag != null);</TD></TR><TR><TD CLASS="l">808</TD><TD>    }</TD></TR><TR><TD CLASS="l">809</TD><TD> </TD></TR><TR><TD CLASS="l">810</TD><TD>    /**</TD></TR><TR><TD CLASS="l">811</TD><TD>     * Returns true if this object contains an &lt;code&gt;Id3v1&lt;/code&gt; tag</TD></TR><TR><TD CLASS="l"><A NAME="c">812</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">813</TD><TD>     * @return true if this object contains an &lt;code&gt;Id3v1&lt;/code&gt; tag</TD></TR><TR><TD CLASS="l">814</TD><TD>     */</TD></TR><TR><TD CLASS="l">815</TD><TD>    public boolean hasID3v1Tag() {</TD></TR><TR CLASS="z"><TD CLASS="l">816</TD><TD>        return (id3v1tag != null);</TD></TR><TR><TD CLASS="l">817</TD><TD>    }</TD></TR><TR><TD CLASS="l">818</TD><TD> </TD></TR><TR><TD CLASS="l">819</TD><TD>    /**</TD></TR><TR><TD CLASS="l">820</TD><TD>     * Returns true if this object contains an &lt;code&gt;Id3v2&lt;/code&gt; tag</TD></TR><TR><TD CLASS="l"><A NAME="32">821</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">822</TD><TD>     * @return true if this object contains an &lt;code&gt;Id3v2&lt;/code&gt; tag</TD></TR><TR><TD CLASS="l">823</TD><TD>     */</TD></TR><TR><TD CLASS="l">824</TD><TD>    public boolean hasID3v2Tag() {</TD></TR><TR CLASS="c"><TD CLASS="l">825</TD><TD>        return (id3v2tag != null);</TD></TR><TR><TD CLASS="l">826</TD><TD>    }</TD></TR><TR><TD CLASS="l">827</TD><TD> </TD></TR><TR><TD CLASS="l">828</TD><TD>    /**</TD></TR><TR><TD CLASS="l">829</TD><TD>     * Returns true if this object contains an &lt;code&gt;Lyrics3&lt;/code&gt; tag</TD></TR><TR><TD CLASS="l"><A NAME="d">830</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">831</TD><TD>     * @return true if this object contains an &lt;code&gt;Lyrics3&lt;/code&gt; tag</TD></TR><TR><TD CLASS="l">832</TD><TD>     */</TD></TR><TR><TD CLASS="l">833</TD><TD>    public boolean hasLyrics3Tag() {</TD></TR><TR CLASS="z"><TD CLASS="l">834</TD><TD>        return (lyrics3tag != null);</TD></TR><TR><TD CLASS="l">835</TD><TD>    }</TD></TR><TR><TD CLASS="l">836</TD><TD> </TD></TR><TR><TD CLASS="l">837</TD><TD>    /**</TD></TR><TR><TD CLASS="l">838</TD><TD>     * Saves the tags in this object to the file referred to by this object. It will be saved as</TD></TR><TR><TD CLASS="l">839</TD><TD>     * TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">840</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="33">841</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">842</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">843</TD><TD>     */</TD></TR><TR><TD CLASS="l">844</TD><TD>    public void save() throws IOException, TagException {</TD></TR><TR CLASS="c"><TD CLASS="l">845</TD><TD>        save(mp3file, TagOptionSingleton.getInstance().getDefaultSaveMode());</TD></TR><TR CLASS="c"><TD CLASS="l">846</TD><TD>    }</TD></TR><TR><TD CLASS="l">847</TD><TD> </TD></TR><TR><TD CLASS="l">848</TD><TD>    /**</TD></TR><TR><TD CLASS="l">849</TD><TD>     * Saves the tags in this object to the file referred to by this object. It will be saved as</TD></TR><TR><TD CLASS="l">850</TD><TD>     * TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">851</TD><TD>     *</TD></TR><TR><TD CLASS="l">852</TD><TD>     * @param saveMode write, overwrite, or append. Defined as &lt;code&gt;TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">853</TD><TD>     *                 TagConstants.MP3_FILE_SAVE_OVERWRITE TagConstants.MP3_FILE_SAVE_APPEND &lt;/code&gt;</TD></TR><TR><TD CLASS="l">854</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="18">855</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">856</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">857</TD><TD>     */</TD></TR><TR><TD CLASS="l">858</TD><TD>    public void save(final int saveMode) throws IOException, TagException {</TD></TR><TR CLASS="z"><TD CLASS="l">859</TD><TD>        save(mp3file, saveMode);</TD></TR><TR CLASS="z"><TD CLASS="l">860</TD><TD>    }</TD></TR><TR><TD CLASS="l">861</TD><TD> </TD></TR><TR><TD CLASS="l">862</TD><TD>    /**</TD></TR><TR><TD CLASS="l">863</TD><TD>     * Saves the tags in this object to the file argument. It will be saved as TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">864</TD><TD>     *</TD></TR><TR><TD CLASS="l">865</TD><TD>     * @param filename file to save the this object's tags to</TD></TR><TR><TD CLASS="l">866</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="16">867</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">868</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">869</TD><TD>     */</TD></TR><TR><TD CLASS="l">870</TD><TD>    public void save(final String filename) throws IOException, TagException {</TD></TR><TR CLASS="z"><TD CLASS="l">871</TD><TD>        save(new File(filename), TagOptionSingleton.getInstance().getDefaultSaveMode());</TD></TR><TR CLASS="z"><TD CLASS="l">872</TD><TD>    }</TD></TR><TR><TD CLASS="l">873</TD><TD> </TD></TR><TR><TD CLASS="l">874</TD><TD>    /**</TD></TR><TR><TD CLASS="l">875</TD><TD>     * Saves the tags in this object to the file argument. It will be saved as TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">876</TD><TD>     *</TD></TR><TR><TD CLASS="l">877</TD><TD>     * @param file file to save the this object's tags to</TD></TR><TR><TD CLASS="l">878</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="15">879</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">880</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">881</TD><TD>     */</TD></TR><TR><TD CLASS="l">882</TD><TD>    public void save(final File file) throws IOException, TagException {</TD></TR><TR CLASS="z"><TD CLASS="l">883</TD><TD>        save(file, TagOptionSingleton.getInstance().getDefaultSaveMode());</TD></TR><TR CLASS="z"><TD CLASS="l">884</TD><TD>    }</TD></TR><TR><TD CLASS="l">885</TD><TD> </TD></TR><TR><TD CLASS="l">886</TD><TD>    /**</TD></TR><TR><TD CLASS="l">887</TD><TD>     * Saves the tags in this object to the file argument. It will be saved as TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">888</TD><TD>     *</TD></TR><TR><TD CLASS="l">889</TD><TD>     * @param filename file to save the this object's tags to</TD></TR><TR><TD CLASS="l">890</TD><TD>     * @param saveMode write, overwrite, or append. Defined as &lt;code&gt;TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">891</TD><TD>     *                 TagConstants.MP3_FILE_SAVE_OVERWRITE TagConstants.MP3_FILE_SAVE_APPEND &lt;/code&gt;</TD></TR><TR><TD CLASS="l">892</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="17">893</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">894</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">895</TD><TD>     */</TD></TR><TR><TD CLASS="l">896</TD><TD>    public void save(final String filename, final int saveMode) throws IOException, TagException {</TD></TR><TR CLASS="z"><TD CLASS="l">897</TD><TD>        save(new File(filename), saveMode);</TD></TR><TR CLASS="z"><TD CLASS="l">898</TD><TD>    }</TD></TR><TR><TD CLASS="l">899</TD><TD> </TD></TR><TR><TD CLASS="l">900</TD><TD>    /**</TD></TR><TR><TD CLASS="l">901</TD><TD>     * Saves the tags in this object to the file argument. It will be saved as TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">902</TD><TD>     *</TD></TR><TR><TD CLASS="l">903</TD><TD>     * @param file     file to save the this object's tags to</TD></TR><TR><TD CLASS="l">904</TD><TD>     * @param saveMode write, overwrite, or append. Defined as &lt;code&gt;TagConstants.MP3_FILE_SAVE_WRITE</TD></TR><TR><TD CLASS="l">905</TD><TD>     *                 TagConstants.MP3_FILE_SAVE_OVERWRITE TagConstants.MP3_FILE_SAVE_APPEND &lt;/code&gt;</TD></TR><TR><TD CLASS="l">906</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="20">907</A></TD><TD>     * @throws IOException  on any I/O error</TD></TR><TR><TD CLASS="l">908</TD><TD>     * @throws TagException on any exception generated by this library.</TD></TR><TR><TD CLASS="l">909</TD><TD>     */</TD></TR><TR><TD CLASS="l">910</TD><TD>    public void save(final File file, final int saveMode) throws IOException, TagException {</TD></TR><TR CLASS="c"><TD CLASS="l">911</TD><TD>        if ((saveMode &lt; TagConstant.MP3_FILE_SAVE_FIRST) || (saveMode &gt; TagConstant.MP3_FILE_SAVE_LAST)) {</TD></TR><TR CLASS="z"><TD CLASS="l">912</TD><TD>            throw new TagException(&#34;Invalid Save Mode&#34;);</TD></TR><TR><TD CLASS="l">913</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">914</TD><TD>        RandomAccessFile rfile = null;</TD></TR><TR><TD CLASS="l">915</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">916</TD><TD>            if (id3v2tag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">917</TD><TD>                adjustID3v2Padding(TagOptionSingleton.getInstance().getId3v2PaddingSize(),</TD></TR><TR><TD CLASS="l">918</TD><TD>                                   TagOptionSingleton.getInstance().isId3v2PaddingWillShorten(),</TD></TR><TR><TD CLASS="l">919</TD><TD>                                   TagOptionSingleton.getInstance().isId3v2PaddingCopyTag(),</TD></TR><TR><TD CLASS="l">920</TD><TD>                                   file);</TD></TR><TR><TD CLASS="l">921</TD><TD>            }</TD></TR><TR><TD CLASS="l">922</TD><TD> </TD></TR><TR><TD CLASS="l">923</TD><TD>            // we can't put these two if's together because</TD></TR><TR><TD CLASS="l">924</TD><TD>            // adjustid3v2padding needs all handles on the file closed;</TD></TR><TR CLASS="c"><TD CLASS="l">925</TD><TD>            rfile = new RandomAccessFile(file, &#34;rw&#34;);</TD></TR><TR CLASS="c"><TD CLASS="l">926</TD><TD>            if (TagOptionSingleton.getInstance().isId3v2Save()) {</TD></TR><TR CLASS="c"><TD CLASS="l">927</TD><TD>                if (id3v2tag == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">928</TD><TD>                    if (saveMode == TagConstant.MP3_FILE_SAVE_OVERWRITE) {</TD></TR><TR CLASS="c"><TD CLASS="l">929</TD><TD>                        (new ID3v2_4()).delete(rfile);</TD></TR><TR><TD CLASS="l">930</TD><TD>                    }</TD></TR><TR><TD CLASS="l">931</TD><TD>                } else {</TD></TR><TR CLASS="c"><TD CLASS="l">932</TD><TD>                    if (saveMode == TagConstant.MP3_FILE_SAVE_WRITE) {</TD></TR><TR CLASS="c"><TD CLASS="l">933</TD><TD>                        id3v2tag.write(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">934</TD><TD>                    } else if (saveMode == TagConstant.MP3_FILE_SAVE_APPEND) {</TD></TR><TR CLASS="z"><TD CLASS="l">935</TD><TD>                        id3v2tag.append(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">936</TD><TD>                    } else if (saveMode == TagConstant.MP3_FILE_SAVE_OVERWRITE) {</TD></TR><TR CLASS="c"><TD CLASS="l">937</TD><TD>                        id3v2tag.overwrite(rfile);</TD></TR><TR><TD CLASS="l">938</TD><TD>                    }</TD></TR><TR><TD CLASS="l">939</TD><TD>                }</TD></TR><TR><TD CLASS="l">940</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">941</TD><TD>            if (TagOptionSingleton.getInstance().isLyrics3Save()) {</TD></TR><TR CLASS="c"><TD CLASS="l">942</TD><TD>                if (lyrics3tag == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">943</TD><TD>                    if (saveMode == TagConstant.MP3_FILE_SAVE_OVERWRITE) {</TD></TR><TR CLASS="c"><TD CLASS="l">944</TD><TD>                        (new Lyrics3v2()).delete(rfile);</TD></TR><TR><TD CLASS="l">945</TD><TD>                    }</TD></TR><TR><TD CLASS="l">946</TD><TD>                } else {</TD></TR><TR CLASS="c"><TD CLASS="l">947</TD><TD>                    if (saveMode == TagConstant.MP3_FILE_SAVE_WRITE) {</TD></TR><TR CLASS="z"><TD CLASS="l">948</TD><TD>                        lyrics3tag.write(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">949</TD><TD>                    } else if (saveMode == TagConstant.MP3_FILE_SAVE_APPEND) {</TD></TR><TR CLASS="z"><TD CLASS="l">950</TD><TD>                        lyrics3tag.append(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">951</TD><TD>                    } else if (saveMode == TagConstant.MP3_FILE_SAVE_OVERWRITE) {</TD></TR><TR CLASS="c"><TD CLASS="l">952</TD><TD>                        lyrics3tag.overwrite(rfile);</TD></TR><TR><TD CLASS="l">953</TD><TD>                    }</TD></TR><TR><TD CLASS="l">954</TD><TD>                }</TD></TR><TR><TD CLASS="l">955</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">956</TD><TD>            if (TagOptionSingleton.getInstance().isId3v1Save()) {</TD></TR><TR CLASS="c"><TD CLASS="l">957</TD><TD>                if (id3v1tag == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">958</TD><TD>                    if (saveMode == TagConstant.MP3_FILE_SAVE_OVERWRITE) {</TD></TR><TR CLASS="c"><TD CLASS="l">959</TD><TD>                        (new ID3v1()).delete(rfile);</TD></TR><TR><TD CLASS="l">960</TD><TD>                    }</TD></TR><TR><TD CLASS="l">961</TD><TD>                } else {</TD></TR><TR CLASS="c"><TD CLASS="l">962</TD><TD>                    if (saveMode == TagConstant.MP3_FILE_SAVE_WRITE) {</TD></TR><TR CLASS="z"><TD CLASS="l">963</TD><TD>                        id3v1tag.write(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">964</TD><TD>                    } else if (saveMode == TagConstant.MP3_FILE_SAVE_APPEND) {</TD></TR><TR CLASS="z"><TD CLASS="l">965</TD><TD>                        id3v1tag.append(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">966</TD><TD>                    } else if (saveMode == TagConstant.MP3_FILE_SAVE_OVERWRITE) {</TD></TR><TR CLASS="c"><TD CLASS="l">967</TD><TD>                        id3v1tag.overwrite(rfile);</TD></TR><TR><TD CLASS="l">968</TD><TD>                    }</TD></TR><TR><TD CLASS="l">969</TD><TD>                }</TD></TR><TR><TD CLASS="l">970</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">971</TD><TD>            if (TagOptionSingleton.getInstance().isFilenameTagSave()) {</TD></TR><TR CLASS="c"><TD CLASS="l">972</TD><TD>                if (filenameTag != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">973</TD><TD>                    if (saveMode == TagConstant.MP3_FILE_SAVE_WRITE) {</TD></TR><TR CLASS="z"><TD CLASS="l">974</TD><TD>                        filenameTag.write(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">975</TD><TD>                    } else if (saveMode == TagConstant.MP3_FILE_SAVE_APPEND) {</TD></TR><TR CLASS="z"><TD CLASS="l">976</TD><TD>                        filenameTag.append(rfile);</TD></TR><TR CLASS="c"><TD CLASS="l">977</TD><TD>                    } else if (saveMode == TagConstant.MP3_FILE_SAVE_OVERWRITE) {</TD></TR><TR CLASS="c"><TD CLASS="l">978</TD><TD>                        filenameTag.overwrite(rfile);</TD></TR><TR><TD CLASS="l">979</TD><TD>                    }</TD></TR><TR><TD CLASS="l">980</TD><TD>                }</TD></TR><TR><TD CLASS="l">981</TD><TD>            }</TD></TR><TR><TD CLASS="l">982</TD><TD>        } finally {</TD></TR><TR CLASS="c"><TD CLASS="l">983</TD><TD>            if (rfile != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">984</TD><TD>                rfile.close();</TD></TR><TR><TD CLASS="l">985</TD><TD>            }</TD></TR><TR><TD CLASS="l">986</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">987</TD><TD>    }</TD></TR><TR><TD CLASS="l">988</TD><TD> </TD></TR><TR><TD CLASS="l">989</TD><TD>    /**</TD></TR><TR><TD CLASS="l">990</TD><TD>     * Returns true if the first MP3 frame can be found for the MP3 file that this object refers to. This is the first</TD></TR><TR><TD CLASS="l">991</TD><TD>     * byte of music data and not the ID3 Tag Frame.</TD></TR><TR><TD CLASS="l">992</TD><TD>     *</TD></TR><TR><TD CLASS="l">993</TD><TD>     * @return true if the first MP3 frame can be found</TD></TR><TR><TD CLASS="l"><A NAME="19">994</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">995</TD><TD>     * @throws IOException on any I/O error</TD></TR><TR><TD CLASS="l">996</TD><TD>     */</TD></TR><TR><TD CLASS="l">997</TD><TD>    public boolean seekMP3Frame() throws IOException {</TD></TR><TR CLASS="z"><TD CLASS="l">998</TD><TD>        RandomAccessFile rfile = null;</TD></TR><TR CLASS="z"><TD CLASS="l">999</TD><TD>        boolean found = false;</TD></TR><TR><TD CLASS="l">1000</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">1001</TD><TD>            rfile = new RandomAccessFile(mp3file, &#34;r&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1002</TD><TD>            found = seekMP3Frame(rfile);</TD></TR><TR><TD CLASS="l">1003</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">1004</TD><TD>            if (rfile != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1005</TD><TD>                rfile.close();</TD></TR><TR><TD CLASS="l">1006</TD><TD>            }</TD></TR><TR><TD CLASS="l">1007</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1008</TD><TD>        return found;</TD></TR><TR><TD CLASS="l">1009</TD><TD>    }</TD></TR><TR><TD CLASS="l">1010</TD><TD> </TD></TR><TR><TD CLASS="l">1011</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1012</TD><TD>     * Returns true if the first MP3 frame can be found for the MP3 file argument. It tries to sync as many frame as</TD></TR><TR><TD CLASS="l">1013</TD><TD>     * defined in &lt;code&gt;TagOptions.getNumberMP3SyncFrame&lt;/code&gt; This is the first byte of music data and not the ID3 Tag</TD></TR><TR><TD CLASS="l">1014</TD><TD>     * Frame.</TD></TR><TR><TD CLASS="l">1015</TD><TD>     *</TD></TR><TR><TD CLASS="l">1016</TD><TD>     * @param seekFile MP3 file to seek</TD></TR><TR><TD CLASS="l">1017</TD><TD>     *</TD></TR><TR><TD CLASS="l">1018</TD><TD>     * @return true if the first MP3 frame can be found</TD></TR><TR><TD CLASS="l"><A NAME="23">1019</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">1020</TD><TD>     * @throws IOException on any I/O error</TD></TR><TR><TD CLASS="l">1021</TD><TD>     */</TD></TR><TR><TD CLASS="l">1022</TD><TD>    public boolean seekMP3Frame(final RandomAccessFile seekFile) throws IOException {</TD></TR><TR CLASS="c"><TD CLASS="l">1023</TD><TD>        boolean syncFound = false;</TD></TR><TR><TD CLASS="l">1024</TD><TD>        byte first;</TD></TR><TR><TD CLASS="l">1025</TD><TD>        byte second;</TD></TR><TR CLASS="c"><TD CLASS="l">1026</TD><TD>        long filePointer = 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1027</TD><TD>        variableBitRate = false;</TD></TR><TR><TD CLASS="l">1028</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">1029</TD><TD>            seekFile.seek(0);</TD></TR><TR><TD CLASS="l">1030</TD><TD>            do {</TD></TR><TR CLASS="c"><TD CLASS="l">1031</TD><TD>                first = seekFile.readByte();</TD></TR><TR CLASS="c"><TD CLASS="l">1032</TD><TD>                if (first == (byte) 0xFF) {</TD></TR><TR CLASS="c"><TD CLASS="l">1033</TD><TD>                    filePointer = seekFile.getFilePointer();</TD></TR><TR CLASS="c"><TD CLASS="l">1034</TD><TD>                    second = (byte) (seekFile.readByte() &amp; (byte) 0xE0);</TD></TR><TR CLASS="c"><TD CLASS="l">1035</TD><TD>                    if (second == (byte) 0xE0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1036</TD><TD>                        seekFile.seek(filePointer - 1);</TD></TR><TR><TD CLASS="l">1037</TD><TD> </TD></TR><TR><TD CLASS="l">1038</TD><TD>                        // seek the next frames, recursively</TD></TR><TR CLASS="c"><TD CLASS="l">1039</TD><TD>                        syncFound = seekNextMP3Frame(seekFile,</TD></TR><TR><TD CLASS="l">1040</TD><TD>                                                     TagOptionSingleton.getInstance().getNumberMP3SyncFrame());</TD></TR><TR><TD CLASS="l">1041</TD><TD>                    }</TD></TR><TR CLASS="c"><TD CLASS="l">1042</TD><TD>                    seekFile.seek(filePointer);</TD></TR><TR><TD CLASS="l">1043</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1044</TD><TD>            } while (syncFound == false);</TD></TR><TR CLASS="c"><TD CLASS="l">1045</TD><TD>            seekFile.seek(filePointer - 1);</TD></TR><TR CLASS="z"><TD CLASS="l">1046</TD><TD>        } catch (EOFException ex) {</TD></TR><TR CLASS="z"><TD CLASS="l">1047</TD><TD>            syncFound = false;</TD></TR><TR CLASS="z"><TD CLASS="l">1048</TD><TD>        } catch (IOException ex) {</TD></TR><TR CLASS="z"><TD CLASS="l">1049</TD><TD>            throw ex;</TD></TR><TR CLASS="p"><TD TITLE="60% line coverage (6 out of 10 instructions)" CLASS="l">1050</TD><TD TITLE="60% line coverage (6 out of 10 instructions)">        }</TD></TR><TR CLASS="c"><TD CLASS="l">1051</TD><TD>        return syncFound;</TD></TR><TR><TD CLASS="l">1052</TD><TD>    }</TD></TR><TR><TD CLASS="l">1053</TD><TD> </TD></TR><TR><TD CLASS="l">1054</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1055</TD><TD>     * Returns the MP3 frame size for the file this object refers to. It assumes that &lt;code&gt;seekNextMP3Frame&lt;/code&gt; has</TD></TR><TR><TD CLASS="l">1056</TD><TD>     * already been called.</TD></TR><TR><TD CLASS="l"><A NAME="1e">1057</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">1058</TD><TD>     * @return MP3 Frame size in bytes.</TD></TR><TR><TD CLASS="l">1059</TD><TD>     */</TD></TR><TR><TD CLASS="l">1060</TD><TD>    private int getFrameSize() {</TD></TR><TR CLASS="c"><TD CLASS="l">1061</TD><TD>        if (frequency == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1062</TD><TD>            return 0;</TD></TR><TR><TD CLASS="l">1063</TD><TD>        }</TD></TR><TR><TD CLASS="l">1064</TD><TD>        final int size;</TD></TR><TR CLASS="c"><TD CLASS="l">1065</TD><TD>        final int paddingByte = padding ? 1 : 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1066</TD><TD>        if (layer == 3) { // Layer I</TD></TR><TR CLASS="z"><TD CLASS="l">1067</TD><TD>            size = (int) ((((12 * bitRate) / frequency) + paddingByte) * 4);</TD></TR><TR><TD CLASS="l">1068</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1069</TD><TD>            size = (int) (((144 * bitRate) / frequency) + paddingByte);</TD></TR><TR><TD CLASS="l">1070</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1071</TD><TD>        return size;</TD></TR><TR><TD CLASS="l">1072</TD><TD>    }</TD></TR><TR><TD CLASS="l">1073</TD><TD> </TD></TR><TR><TD CLASS="l">1074</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1075</TD><TD>     * Reads the mp3 frame header from the current posiiton in the file and sets this object's private variables to what</TD></TR><TR><TD CLASS="l">1076</TD><TD>     * is found. It assumes the &lt;code&gt;RandomAccessFile&lt;/code&gt; is already pointing to a valid MP3 Frame.</TD></TR><TR><TD CLASS="l">1077</TD><TD>     *</TD></TR><TR><TD CLASS="l">1078</TD><TD>     * @param file File to read frame header</TD></TR><TR><TD CLASS="l">1079</TD><TD>     *</TD></TR><TR><TD CLASS="l">1080</TD><TD>     * @throws IOException          on any I/O error</TD></TR><TR><TD CLASS="l">1081</TD><TD>     * @throws TagNotFoundException if MP3 Frame sync bites were not immediately found</TD></TR><TR><TD CLASS="l"><A NAME="22">1082</A></TD><TD>     * @throws InvalidTagException  if any of the header values are invlaid</TD></TR><TR><TD CLASS="l">1083</TD><TD>     */</TD></TR><TR><TD CLASS="l">1084</TD><TD>    private void readFrameHeader(final RandomAccessFile file)</TD></TR><TR><TD CLASS="l">1085</TD><TD>            throws IOException, TagNotFoundException, InvalidTagException {</TD></TR><TR CLASS="c"><TD CLASS="l">1086</TD><TD>        final byte[] buffer = new byte[4];</TD></TR><TR CLASS="c"><TD CLASS="l">1087</TD><TD>        file.read(buffer);</TD></TR><TR><TD CLASS="l">1088</TD><TD> </TD></TR><TR><TD CLASS="l">1089</TD><TD>        // sync</TD></TR><TR CLASS="c"><TD CLASS="l">1090</TD><TD>        if ((buffer[0] != (byte) 0xFF) || ((buffer[1] &amp; (byte) 0xE0) != (byte) 0xE0)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1091</TD><TD>            throw new TagNotFoundException(&#34;MP3 Frame sync bits not found&#34;);</TD></TR><TR><TD CLASS="l">1092</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1093</TD><TD>        mpegVersion = (byte) ((buffer[1] &amp; TagConstant.MASK_MP3_VERSION) &gt;&gt; 3);</TD></TR><TR CLASS="c"><TD CLASS="l">1094</TD><TD>        layer = (byte) ((buffer[1] &amp; TagConstant.MASK_MP3_LAYER) &gt;&gt; 1);</TD></TR><TR CLASS="c"><TD CLASS="l">1095</TD><TD>        protection = (buffer[1] &amp; TagConstant.MASK_MP3_PROTECTION) != 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1096</TD><TD>        final int bitRateValue = (buffer[2] &amp; TagConstant.MASK_MP3_BITRATE) |</TD></TR><TR><TD CLASS="l">1097</TD><TD>                                 (buffer[1] &amp; TagConstant.MASK_MP3_ID) |</TD></TR><TR><TD CLASS="l">1098</TD><TD>                                 (buffer[1] &amp; TagConstant.MASK_MP3_LAYER);</TD></TR><TR CLASS="c"><TD CLASS="l">1099</TD><TD>        final Long object = (Long) TagConstant.bitrate.get(new Long(bitRateValue));</TD></TR><TR CLASS="c"><TD CLASS="l">1100</TD><TD>        if (object != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1101</TD><TD>            if (object.longValue() != bitRate) {</TD></TR><TR CLASS="c"><TD CLASS="l">1102</TD><TD>                variableBitRate = true;</TD></TR><TR><TD CLASS="l">1103</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1104</TD><TD>            bitRate = object.intValue();</TD></TR><TR><TD CLASS="l">1105</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1106</TD><TD>            throw new InvalidTagException(&#34;Invalid bit rate&#34;);</TD></TR><TR><TD CLASS="l">1107</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1108</TD><TD>        final int frequencyValue = (buffer[2] &amp; TagConstant.MASK_MP3_FREQUENCY) &gt;&gt;&gt; 2;</TD></TR><TR CLASS="c"><TD CLASS="l">1109</TD><TD>        if (mpegVersion == 3) { // Version 1.0</TD></TR><TR CLASS="c"><TD CLASS="l">1110</TD><TD>            switch (frequencyValue) {</TD></TR><TR><TD CLASS="l">1111</TD><TD>                case 0:</TD></TR><TR CLASS="c"><TD CLASS="l">1112</TD><TD>                    frequency = 44.1;</TD></TR><TR CLASS="c"><TD CLASS="l">1113</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1114</TD><TD>                case 1:</TD></TR><TR CLASS="z"><TD CLASS="l">1115</TD><TD>                    frequency = 48.0;</TD></TR><TR CLASS="z"><TD CLASS="l">1116</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1117</TD><TD>                case 2:</TD></TR><TR CLASS="z"><TD CLASS="l">1118</TD><TD>                    frequency = 32.0;</TD></TR><TR CLASS="c"><TD CLASS="l">1119</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1120</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1121</TD><TD>        } else if (mpegVersion == 2) { // Version 2.0</TD></TR><TR CLASS="c"><TD CLASS="l">1122</TD><TD>            switch (frequencyValue) {</TD></TR><TR><TD CLASS="l">1123</TD><TD>                case 0:</TD></TR><TR CLASS="c"><TD CLASS="l">1124</TD><TD>                    frequency = 22.05;</TD></TR><TR CLASS="c"><TD CLASS="l">1125</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1126</TD><TD>                case 1:</TD></TR><TR CLASS="z"><TD CLASS="l">1127</TD><TD>                    frequency = 24.00;</TD></TR><TR CLASS="z"><TD CLASS="l">1128</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1129</TD><TD>                case 2:</TD></TR><TR CLASS="z"><TD CLASS="l">1130</TD><TD>                    frequency = 16.00;</TD></TR><TR CLASS="c"><TD CLASS="l">1131</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1132</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1133</TD><TD>        } else if (mpegVersion == 00) { // Version 2.5</TD></TR><TR CLASS="z"><TD CLASS="l">1134</TD><TD>            switch (frequencyValue) {</TD></TR><TR><TD CLASS="l">1135</TD><TD>                case 0:</TD></TR><TR CLASS="z"><TD CLASS="l">1136</TD><TD>                    frequency = 11.025;</TD></TR><TR CLASS="z"><TD CLASS="l">1137</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1138</TD><TD>                case 1:</TD></TR><TR CLASS="z"><TD CLASS="l">1139</TD><TD>                    frequency = 12.00;</TD></TR><TR CLASS="z"><TD CLASS="l">1140</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1141</TD><TD>                case 2:</TD></TR><TR CLASS="z"><TD CLASS="l">1142</TD><TD>                    frequency = 8.00;</TD></TR><TR CLASS="z"><TD CLASS="l">1143</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">1144</TD><TD>            }</TD></TR><TR><TD CLASS="l">1145</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1146</TD><TD>            throw new InvalidTagException(&#34;Invalid MPEG version&#34;);</TD></TR><TR><TD CLASS="l">1147</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1148</TD><TD>        padding = (buffer[2] &amp; TagConstant.MASK_MP3_PADDING) != 0;</TD></TR><TR CLASS="p"><TD TITLE="95% line coverage (37 out of 39 instructions)" CLASS="l">1149</TD><TD TITLE="95% line coverage (37 out of 39 instructions)">        privacy = (buffer[2] &amp; TagConstant.MASK_MP3_PRIVACY) != 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1150</TD><TD>        mode = (byte) ((buffer[3] &amp; TagConstant.MASK_MP3_MODE) &gt;&gt; 6);</TD></TR><TR CLASS="c"><TD CLASS="l">1151</TD><TD>        modeExtension = (byte) ((buffer[3] &amp; TagConstant.MASK_MP3_MODE_EXTENSION) &gt;&gt; 4);</TD></TR><TR CLASS="p"><TD TITLE="95% line coverage (37 out of 39 instructions)" CLASS="l">1152</TD><TD TITLE="95% line coverage (37 out of 39 instructions)">        copyProtected = (buffer[3] &amp; TagConstant.MASK_MP3_COPY) != 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1153</TD><TD>        home = (buffer[3] &amp; TagConstant.MASK_MP3_HOME) != 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1154</TD><TD>        emphasis = (byte) ((buffer[3] &amp; TagConstant.MASK_MP3_EMPHASIS));</TD></TR><TR CLASS="c"><TD CLASS="l">1155</TD><TD>    }</TD></TR><TR><TD CLASS="l">1156</TD><TD> </TD></TR><TR><TD CLASS="l">1157</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1158</TD><TD>     * Returns true if the first MP3 frame can be found for the MP3 file argument. It is recursive and called by</TD></TR><TR><TD CLASS="l">1159</TD><TD>     * seekMP3Frame. This is the first byte of music data and not the ID3 Tag Frame.</TD></TR><TR><TD CLASS="l">1160</TD><TD>     *</TD></TR><TR><TD CLASS="l">1161</TD><TD>     * @param file       MP3 file to seek</TD></TR><TR><TD CLASS="l">1162</TD><TD>     * @param iterations recursive counter</TD></TR><TR><TD CLASS="l">1163</TD><TD>     *</TD></TR><TR><TD CLASS="l">1164</TD><TD>     * @return true if the first MP3 frame can be found</TD></TR><TR><TD CLASS="l">1165</TD><TD>     *</TD></TR><TR><TD CLASS="l">1166</TD><TD>     * @throws IOException on any I/O error</TD></TR><TR><TD CLASS="l">1167</TD><TD>     */</TD></TR><TR><TD CLASS="l">1168</TD><TD>    private boolean seekNextMP3Frame(final RandomAccessFile file, final int iterations) throws IOException {</TD></TR><TR><TD CLASS="l">1169</TD><TD>        final boolean syncFound;</TD></TR><TR><TD CLASS="l"><A NAME="25">1170</A></TD><TD>        final byte[] buffer;</TD></TR><TR><TD CLASS="l">1171</TD><TD>        final byte first;</TD></TR><TR><TD CLASS="l">1172</TD><TD>        final byte second;</TD></TR><TR><TD CLASS="l">1173</TD><TD>        final long filePointer;</TD></TR><TR CLASS="c"><TD CLASS="l">1174</TD><TD>        if (iterations == 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1175</TD><TD>            syncFound = true;</TD></TR><TR><TD CLASS="l">1176</TD><TD>        } else {</TD></TR><TR><TD CLASS="l">1177</TD><TD>            try {</TD></TR><TR CLASS="c"><TD CLASS="l">1178</TD><TD>                readFrameHeader(file);</TD></TR><TR CLASS="c"><TD CLASS="l">1179</TD><TD>            } catch (TagException ex) {</TD></TR><TR CLASS="c"><TD CLASS="l">1180</TD><TD>                return false;</TD></TR><TR CLASS="c"><TD CLASS="l">1181</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1182</TD><TD>            final int size = getFrameSize();</TD></TR><TR CLASS="c"><TD CLASS="l">1183</TD><TD>            if ((size &lt;= 0) || (size &gt; file.length())) {</TD></TR><TR CLASS="z"><TD CLASS="l">1184</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">1185</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1186</TD><TD>            buffer = new byte[size - 4];</TD></TR><TR CLASS="c"><TD CLASS="l">1187</TD><TD>            file.read(buffer);</TD></TR><TR CLASS="c"><TD CLASS="l">1188</TD><TD>            filePointer = file.getFilePointer();</TD></TR><TR CLASS="c"><TD CLASS="l">1189</TD><TD>            first = file.readByte();</TD></TR><TR CLASS="c"><TD CLASS="l">1190</TD><TD>            if (first == (byte) 0xFF) {</TD></TR><TR CLASS="c"><TD CLASS="l">1191</TD><TD>                second = (byte) (file.readByte() &amp; (byte) 0xE0);</TD></TR><TR CLASS="c"><TD CLASS="l">1192</TD><TD>                if (second == (byte) 0xE0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1193</TD><TD>                    file.seek(filePointer);</TD></TR><TR><TD CLASS="l">1194</TD><TD> </TD></TR><TR><TD CLASS="l">1195</TD><TD>                    // recursively find the next frames</TD></TR><TR CLASS="c"><TD CLASS="l">1196</TD><TD>                    syncFound = seekNextMP3Frame(file, iterations - 1);</TD></TR><TR><TD CLASS="l">1197</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1198</TD><TD>                    syncFound = false;</TD></TR><TR><TD CLASS="l">1199</TD><TD>                }</TD></TR><TR><TD CLASS="l">1200</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1201</TD><TD>                syncFound = false;</TD></TR><TR><TD CLASS="l">1202</TD><TD>            }</TD></TR><TR><TD CLASS="l">1203</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1204</TD><TD>        return syncFound;</TD></TR><TR><TD CLASS="l">1205</TD><TD>    }</TD></TR><TR><TD CLASS="l">1206</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" WIDTH="100%" CELLSPACING="0"><TR><TD CLASS="nv">[<A HREF="../coverage.html">all classes</A>][<A HREF="4.html">org.farng.mp3</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://sourceforge.net/projects/emma">EMMA 2.0.5312</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>